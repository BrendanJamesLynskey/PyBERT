
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pybert.pybert &#8212; PyBERT 3.3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pybert.pybert</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bit error rate tester (BERT) simulator, written in Python.</span>

<span class="sd">Original Author: David Banas &lt;capn.freako@gmail.com&gt;</span>

<span class="sd">Original Date:   17 June 2014</span>

<span class="sd">Testing by: Mark Marlett &lt;mark.marlett@gmail.com&gt;</span>

<span class="sd">This Python script provides a GUI interface to a BERT simulator, which</span>
<span class="sd">can be used to explore the concepts of serial communication link design.</span>

<span class="sd">Copyright (c) 2014 by David Banas; All rights reserved World wide.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># from traits.trait_base import ETSConfig</span>
<span class="c1"># ETSConfig.toolkit = &quot;qt4&quot;</span>
<span class="c1"># ETSConfig.toolkit = &quot;wx&quot;</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">isnan</span>

<span class="kn">from</span> <span class="nn">chaco.api</span> <span class="k">import</span> <span class="n">ArrayPlotData</span><span class="p">,</span> <span class="n">GridPlotContainer</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">convolve</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">real</span><span class="p">,</span> <span class="n">resize</span><span class="p">,</span> <span class="n">sinc</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">zeros</span>
<span class="kn">from</span> <span class="nn">numpy.fft</span> <span class="k">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">minimize</span><span class="p">,</span> <span class="n">minimize_scalar</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">HTML</span><span class="p">,</span>
    <span class="n">Array</span><span class="p">,</span>
    <span class="n">Bool</span><span class="p">,</span>
    <span class="n">Button</span><span class="p">,</span>
    <span class="n">Enum</span><span class="p">,</span>
    <span class="n">File</span><span class="p">,</span>
    <span class="n">Float</span><span class="p">,</span>
    <span class="n">HasTraits</span><span class="p">,</span>
    <span class="n">Instance</span><span class="p">,</span>
    <span class="n">Int</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Property</span><span class="p">,</span>
    <span class="n">Range</span><span class="p">,</span>
    <span class="n">String</span><span class="p">,</span>
    <span class="n">cached_property</span><span class="p">,</span>
    <span class="n">Trait</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">traitsui.message</span> <span class="k">import</span> <span class="n">message</span>

<span class="kn">from</span> <span class="nn">pyibisami.ami_parse</span> <span class="k">import</span> <span class="n">AMIParamConfigurator</span>
<span class="kn">from</span> <span class="nn">pyibisami.ami_model</span> <span class="k">import</span> <span class="n">AMIModel</span>
<span class="kn">from</span> <span class="nn">pyibisami.ibis_file</span> <span class="k">import</span> <span class="n">IBISModel</span>

<span class="kn">from</span> <span class="nn">pybert</span> <span class="k">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">VERSION</span>
<span class="kn">from</span> <span class="nn">pybert</span> <span class="k">import</span> <span class="n">__date__</span> <span class="k">as</span> <span class="n">DATE</span>
<span class="kn">from</span> <span class="nn">pybert</span> <span class="k">import</span> <span class="n">__authors__</span> <span class="k">as</span> <span class="n">AUTHORS</span>
<span class="kn">from</span> <span class="nn">pybert</span> <span class="k">import</span> <span class="n">__copy__</span> <span class="k">as</span> <span class="n">COPY</span>

<span class="kn">from</span> <span class="nn">pybert.pybert_cntrl</span> <span class="k">import</span> <span class="n">my_run_simulation</span>
<span class="kn">from</span> <span class="nn">pybert.pybert_help</span> <span class="k">import</span> <span class="n">help_str</span>
<span class="kn">from</span> <span class="nn">pybert.pybert_plot</span> <span class="k">import</span> <span class="n">make_plots</span>
<span class="kn">from</span> <span class="nn">pybert.pybert_util</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">calc_G</span><span class="p">,</span>
    <span class="n">calc_gamma</span><span class="p">,</span>
    <span class="n">import_channel</span><span class="p">,</span>
    <span class="n">lfsr_bits</span><span class="p">,</span>
    <span class="n">make_ctle</span><span class="p">,</span>
    <span class="n">pulse_center</span><span class="p">,</span>
    <span class="n">safe_log10</span><span class="p">,</span>
    <span class="n">trim_impulse</span><span class="p">,</span>
    <span class="n">submodules</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pybert.pybert_view</span> <span class="k">import</span> <span class="n">traits_view</span>

<span class="n">gDebugStatus</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">gDebugOptimize</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">gMaxCTLEPeak</span> <span class="o">=</span> <span class="mf">20.0</span>  <span class="c1"># max. allowed CTLE peaking (dB) (when optimizing, only)</span>
<span class="n">gMaxCTLEFreq</span> <span class="o">=</span> <span class="mf">20.0</span>  <span class="c1"># max. allowed CTLE peak frequency (GHz) (when optimizing, only)</span>

<span class="c1"># Default model parameters - Modify these to customize the default simulation.</span>
<span class="c1"># - Simulation Control</span>
<span class="n">gBitRate</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># (Gbps)</span>
<span class="n">gNbits</span> <span class="o">=</span> <span class="mi">8000</span>  <span class="c1"># number of bits to run</span>
<span class="n">gPatLen</span> <span class="o">=</span> <span class="mi">127</span>  <span class="c1"># repeating bit pattern length</span>
<span class="n">gNspb</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># samples per bit</span>
<span class="n">gNumAve</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Number of bit error samples to average, when sweeping.</span>
<span class="c1"># - Channel Control</span>
<span class="c1">#     - parameters for Howard Johnson&#39;s &quot;Metallic Transmission Model&quot;</span>
<span class="c1">#     - (See &quot;High Speed Signal Propagation&quot;, Sec. 3.1.)</span>
<span class="c1">#     - ToDo: These are the values for 24 guage twisted copper pair; need to add other options.</span>
<span class="n">gRdc</span> <span class="o">=</span> <span class="mf">0.1876</span>  <span class="c1"># Ohms/m</span>
<span class="n">gw0</span> <span class="o">=</span> <span class="mf">10.0e6</span>  <span class="c1"># 10 MHz is recommended in Ch. 8 of his second book, in which UTP is described in detail.</span>
<span class="n">gR0</span> <span class="o">=</span> <span class="mf">1.452</span>  <span class="c1"># skin-effect resistance (Ohms/m)log</span>
<span class="n">gTheta0</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># loss tangent</span>
<span class="n">gZ0</span> <span class="o">=</span> <span class="mf">100.0</span>  <span class="c1"># characteristic impedance in LC region (Ohms)</span>
<span class="n">gv0</span> <span class="o">=</span> <span class="mf">0.67</span>  <span class="c1"># relative propagation velocity (c)</span>
<span class="n">gl_ch</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># cable length (m)</span>
<span class="n">gRn</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mf">0.001</span>
<span class="p">)</span>  <span class="c1"># standard deviation of Gaussian random noise (V) (Applied at end of channel, so as to appear white to Rx.)</span>
<span class="c1"># - Tx</span>
<span class="n">gVod</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># output drive strength (Vp)</span>
<span class="n">gRs</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># differential source impedance (Ohms)</span>
<span class="n">gCout</span> <span class="o">=</span> <span class="mf">0.50</span>  <span class="c1"># parasitic output capacitance (pF) (Assumed to exist at both &#39;P&#39; and &#39;N&#39; nodes.)</span>
<span class="n">gPnMag</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># magnitude of periodic noise (V)</span>
<span class="n">gPnFreq</span> <span class="o">=</span> <span class="mf">0.437</span>  <span class="c1"># frequency of periodic noise (MHz)</span>
<span class="c1"># - Rx</span>
<span class="n">gRin</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># differential input resistance</span>
<span class="n">gCin</span> <span class="o">=</span> <span class="mf">0.50</span>  <span class="c1"># parasitic input capacitance (pF) (Assumed to exist at both &#39;P&#39; and &#39;N&#39; nodes.)</span>
<span class="n">gCac</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># a.c. coupling capacitance (uF) (Assumed to exist at both &#39;P&#39; and &#39;N&#39; nodes.)</span>
<span class="n">gBW</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c1"># Rx signal path bandwidth, assuming no CTLE action. (GHz)</span>
<span class="n">gUseDfe</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Include DFE when running simulation.</span>
<span class="n">gDfeIdeal</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># DFE ideal summing node selector</span>
<span class="n">gPeakFreq</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># CTLE peaking frequency (GHz)</span>
<span class="n">gPeakMag</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># CTLE peaking magnitude (dB)</span>
<span class="n">gCTLEOffset</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># CTLE d.c. offset (dB)</span>
<span class="c1"># - DFE</span>
<span class="n">gDecisionScaler</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">gNtaps</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">gGain</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">gNave</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">gDfeBW</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c1"># DFE summing node bandwidth (GHz)</span>
<span class="c1"># - CDR</span>
<span class="n">gDeltaT</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># (ps)</span>
<span class="n">gAlpha</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">gNLockAve</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># number of UI used to average CDR locked status.</span>
<span class="n">gRelLockTol</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># relative lock tolerance of CDR.</span>
<span class="n">gLockSustain</span> <span class="o">=</span> <span class="mi">500</span>
<span class="c1"># - Analysis</span>
<span class="n">gThresh</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># threshold for identifying periodic jitter spectral elements (sigma)</span>


<div class="viewcode-block" id="StoppableThread"><a class="viewcode-back" href="../../modules.html#pybert.pybert.StoppableThread">[docs]</a><span class="k">class</span> <span class="nc">StoppableThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thread class with a stop() method.</span>

<span class="sd">    The thread itself has to check regularly for the stopped() condition.</span>

<span class="sd">    All PyBERT thread classes are subclasses of this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StoppableThread</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>

<div class="viewcode-block" id="StoppableThread.stop"><a class="viewcode-back" href="../../modules.html#pybert.pybert.StoppableThread.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called by thread invoker, when thread should be stopped prematurely.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span></div>

<div class="viewcode-block" id="StoppableThread.stopped"><a class="viewcode-back" href="../../modules.html#pybert.pybert.StoppableThread.stopped">[docs]</a>    <span class="k">def</span> <span class="nf">stopped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Should be called by thread (i.e. - subclass) periodically and, if this function</span>
<span class="sd">        returns True, thread should clean itself up and quit ASAP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TxOptThread"><a class="viewcode-back" href="../../modules.html#pybert.pybert.TxOptThread">[docs]</a><span class="k">class</span> <span class="nc">TxOptThread</span><span class="p">(</span><span class="n">StoppableThread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used to run Tx tap weight optimization in its own thread,</span>
<span class="sd">    in order to preserve GUI responsiveness.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TxOptThread.run"><a class="viewcode-back" href="../../modules.html#pybert.pybert.TxOptThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Tx equalization optimization thread.&quot;&quot;&quot;</span>

        <span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pybert</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">:</span>
            <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimizing Tx...&quot;</span>

        <span class="n">max_iter</span> <span class="o">=</span> <span class="n">pybert</span><span class="o">.</span><span class="n">max_iter</span>

        <span class="n">old_taps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="n">pybert</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tuner</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                <span class="n">old_taps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuner</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">min_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuner</span><span class="o">.</span><span class="n">min_val</span><span class="p">)</span>
                <span class="n">max_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuner</span><span class="o">.</span><span class="n">max_val</span><span class="p">)</span>

        <span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ineq&quot;</span><span class="p">,</span> <span class="s2">&quot;fun&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.7</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))}</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">min_vals</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gDebugOptimize</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_opt_tx</span><span class="p">,</span>
                    <span class="n">old_taps</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                    <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">max_iter</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_opt_tx</span><span class="p">,</span>
                    <span class="n">old_taps</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                    <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">max_iter</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
                    <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimization succeeded.&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimization failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">err</span></div>

<div class="viewcode-block" id="TxOptThread.do_opt_tx"><a class="viewcode-back" href="../../modules.html#pybert.pybert.TxOptThread.do_opt_tx">[docs]</a>    <span class="k">def</span> <span class="nf">do_opt_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Tx Optimization.&quot;&quot;&quot;</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1"># Give the GUI a chance to acknowledge user clicking the Abort button.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Optimization aborted.&quot;</span><span class="p">)</span>

        <span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pybert</span>
        <span class="n">tuners</span> <span class="o">=</span> <span class="n">pybert</span><span class="o">.</span><span class="n">tx_tap_tuners</span>
        <span class="n">taps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">taps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="n">tuners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tuner</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                <span class="n">tuner</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">taps</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pybert</span><span class="o">.</span><span class="n">cost</span></div></div>


<div class="viewcode-block" id="RxOptThread"><a class="viewcode-back" href="../../modules.html#pybert.pybert.RxOptThread">[docs]</a><span class="k">class</span> <span class="nc">RxOptThread</span><span class="p">(</span><span class="n">StoppableThread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used to run Rx tap weight optimization in its own thread,</span>
<span class="sd">    in order to preserve GUI responsiveness.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RxOptThread.run"><a class="viewcode-back" href="../../modules.html#pybert.pybert.RxOptThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Rx equalization optimization thread.&quot;&quot;&quot;</span>

        <span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pybert</span>

        <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimizing Rx...&quot;</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="n">pybert</span><span class="o">.</span><span class="n">max_iter</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gDebugOptimize</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_opt_rx</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gMaxCTLEPeak</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">max_iter</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_opt_rx</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gMaxCTLEPeak</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">max_iter</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
                <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimization succeeded.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimization failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">err</span></div>

<div class="viewcode-block" id="RxOptThread.do_opt_rx"><a class="viewcode-back" href="../../modules.html#pybert.pybert.RxOptThread.do_opt_rx">[docs]</a>    <span class="k">def</span> <span class="nf">do_opt_rx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peak_mag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Rx Optimization.&quot;&quot;&quot;</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1"># Give the GUI a chance to acknowledge user clicking the Abort button.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Optimization aborted.&quot;</span><span class="p">)</span>

        <span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pybert</span>
        <span class="n">pybert</span><span class="o">.</span><span class="n">peak_mag_tune</span> <span class="o">=</span> <span class="n">peak_mag</span>
        <span class="k">return</span> <span class="n">pybert</span><span class="o">.</span><span class="n">cost</span></div></div>


<div class="viewcode-block" id="CoOptThread"><a class="viewcode-back" href="../../modules.html#pybert.pybert.CoOptThread">[docs]</a><span class="k">class</span> <span class="nc">CoOptThread</span><span class="p">(</span><span class="n">StoppableThread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used to run co-optimization in its own thread, in order to preserve GUI responsiveness.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CoOptThread.run"><a class="viewcode-back" href="../../modules.html#pybert.pybert.CoOptThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Tx/Rx equalization co-optimization thread.&quot;&quot;&quot;</span>

        <span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pybert</span>

        <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Co-optimizing...&quot;</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="n">pybert</span><span class="o">.</span><span class="n">max_iter</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gDebugOptimize</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_coopt</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gMaxCTLEPeak</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">max_iter</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_coopt</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gMaxCTLEPeak</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">max_iter</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
                <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimization succeeded.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Optimization failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">pybert</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">err</span></div>

<div class="viewcode-block" id="CoOptThread.do_coopt"><a class="viewcode-back" href="../../modules.html#pybert.pybert.CoOptThread.do_coopt">[docs]</a>    <span class="k">def</span> <span class="nf">do_coopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peak_mag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Tx and Rx Co-Optimization.&quot;&quot;&quot;</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1"># Give the GUI a chance to acknowledge user clicking the Abort button.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Optimization aborted.&quot;</span><span class="p">)</span>

        <span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pybert</span>
        <span class="n">pybert</span><span class="o">.</span><span class="n">peak_mag_tune</span> <span class="o">=</span> <span class="n">peak_mag</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">pybert</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pybert</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">))]):</span>
            <span class="k">while</span> <span class="n">pybert</span><span class="o">.</span><span class="n">tx_opt_thread</span> <span class="ow">and</span> <span class="n">pybert</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
            <span class="n">pybert</span><span class="o">.</span><span class="n">_do_opt_tx</span><span class="p">(</span><span class="n">update_status</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">pybert</span><span class="o">.</span><span class="n">tx_opt_thread</span> <span class="ow">and</span> <span class="n">pybert</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pybert</span><span class="o">.</span><span class="n">cost</span></div></div>


<div class="viewcode-block" id="TxTapTuner"><a class="viewcode-back" href="../../modules.html#pybert.pybert.TxTapTuner">[docs]</a><span class="k">class</span> <span class="nc">TxTapTuner</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object used to populate the rows of the Tx FFE tap tuning table.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="s2">&quot;(noname)&quot;</span><span class="p">)</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Non-zero means we want to sweep it.</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;(noname)&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allows user to define properties, at instantiation.&quot;&quot;&quot;</span>

        <span class="c1"># Super-class initialization is ABSOLUTELY NECESSARY, in order</span>
        <span class="c1"># to get all the Traits/UI machinery setup correctly.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TxTapTuner</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span> <span class="o">=</span> <span class="n">min_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span></div>


<div class="viewcode-block" id="PyBERT"><a class="viewcode-back" href="../../modules.html#pybert.pybert.PyBERT">[docs]</a><span class="k">class</span> <span class="nc">PyBERT</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A serial communication link bit error rate tester (BERT) simulator with a GUI interface.</span>

<span class="sd">    Useful for exploring the concepts of serial communication link design.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">reraise</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set to `True` only for serious development debugging mode.</span>

    <span class="c1"># Independent variables</span>

    <span class="c1"># - Simulation Control</span>
    <span class="n">bit_rate</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">120.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gBitRate</span><span class="p">)</span>     <span class="c1">#: (Gbps)</span>
    <span class="n">nbits</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10000000</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gNbits</span><span class="p">)</span>      <span class="c1">#: Number of bits to simulate.</span>
    <span class="n">pattern_len</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10000000</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gPatLen</span><span class="p">)</span>  <span class="c1">#: PRBS pattern length.</span>
    <span class="n">nspb</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gNspb</span><span class="p">)</span>                <span class="c1">#: Signal vector samples per bit.</span>
    <span class="n">eye_bits</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gNbits</span> <span class="o">//</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1">#: # of bits used to form eye. (Default = last 20%)</span>
    <span class="n">mod_type</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>         <span class="c1">#: 0 = NRZ; 1 = Duo-binary; 2 = PAM-4</span>
    <span class="n">num_sweeps</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>          <span class="c1">#: Number of sweeps to run.</span>
    <span class="n">sweep_num</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sweep_aves</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gNumAve</span><span class="p">)</span>
    <span class="n">do_sweep</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: Run sweeps? (Default = False)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>      <span class="c1">#: Send log messages to terminal, as well as console, when True. (Default = False)</span>

    <span class="c1"># - Channel Control</span>
    <span class="n">ch_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.s4p&quot;</span><span class="p">,</span> <span class="s2">&quot;*.S4P&quot;</span><span class="p">,</span> <span class="s2">&quot;*.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;*.CSV&quot;</span><span class="p">,</span> <span class="s2">&quot;*.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;*.TXT&quot;</span><span class="p">,</span> <span class="s2">&quot;*.*&quot;</span><span class="p">]</span>
    <span class="p">)</span>                          <span class="c1">#: Channel file name.</span>
    <span class="n">chnl_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>   <span class="c1">#: Channel file is valid.</span>
    <span class="n">use_ch_file</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: Import channel description from file? (Default = False)</span>
    <span class="n">Zref</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>          <span class="c1">#: Reference (or, nominal) channel impedance.</span>
    <span class="n">padded</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>       <span class="c1">#: Zero pad imported Touchstone data? (Default = False)</span>
    <span class="n">windowed</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>     <span class="c1">#: Apply windowing to the Touchstone data? (Default = False)</span>
    <span class="n">f_step</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>         <span class="c1">#: Frequency step to use when constructing H(f). (Default = 10 MHz)</span>
    <span class="n">impulse_length</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1">#: Impulse response length. (Determined automatically, when 0.)</span>
    <span class="n">Rdc</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gRdc</span><span class="p">)</span>            <span class="c1">#: Channel d.c. resistance (Ohms/m).</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gw0</span><span class="p">)</span>              <span class="c1">#: Channel transition frequency (rads./s).</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gR0</span><span class="p">)</span>              <span class="c1">#: Channel skin effect resistance (Ohms/m).</span>
    <span class="n">Theta0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gTheta0</span><span class="p">)</span>      <span class="c1">#: Channel loss tangent (unitless).</span>
    <span class="n">Z0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gZ0</span><span class="p">)</span>              <span class="c1">#: Channel characteristic impedance, in LC region (Ohms).</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gv0</span><span class="p">)</span>              <span class="c1">#: Channel relative propagation velocity (c).</span>
    <span class="n">l_ch</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gl_ch</span><span class="p">)</span>          <span class="c1">#: Channel length (m).</span>

    <span class="c1"># - EQ Tune</span>
    <span class="n">tx_tap_tuners</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Pre-tap&quot;</span><span class="p">,</span>   <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Post-tap1&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Post-tap2&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Post-tap3&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>  <span class="c1">#: EQ optimizer list of TxTapTuner objects.</span>
    <span class="n">rx_bw_tune</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gBW</span><span class="p">)</span>  <span class="c1">#: EQ optimizer CTLE bandwidth (GHz).</span>
    <span class="n">peak_freq_tune</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gPeakFreq</span><span class="p">)</span>  <span class="c1">#: EQ optimizer CTLE peaking freq. (GHz).</span>
    <span class="n">peak_mag_tune</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gPeakMag</span><span class="p">)</span>  <span class="c1">#: EQ optimizer CTLE peaking mag. (dB).</span>
    <span class="n">ctle_offset_tune</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gCTLEOffset</span><span class="p">)</span>  <span class="c1">#: EQ optimizer CTLE d.c. offset (dB).</span>
    <span class="n">ctle_mode_tune</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span>
        <span class="s2">&quot;Off&quot;</span><span class="p">,</span> <span class="s2">&quot;Passive&quot;</span><span class="p">,</span> <span class="s2">&quot;AGC&quot;</span><span class="p">,</span> <span class="s2">&quot;Manual&quot;</span>
    <span class="p">)</span>  <span class="c1">#: EQ optimizer CTLE mode (&#39;Off&#39;, &#39;Passive&#39;, &#39;AGC&#39;, &#39;Manual&#39;).</span>
    <span class="n">use_dfe_tune</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">gUseDfe</span><span class="p">)</span>  <span class="c1">#: EQ optimizer DFE select (Bool).</span>
    <span class="n">n_taps_tune</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gNtaps</span><span class="p">)</span>  <span class="c1">#: EQ optimizer # DFE taps.</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>  <span class="c1">#: EQ optimizer max. # of optimization iterations.</span>
    <span class="n">tx_opt_thread</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">TxOptThread</span><span class="p">)</span>  <span class="c1">#: Tx EQ optimization thread.</span>
    <span class="n">rx_opt_thread</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">RxOptThread</span><span class="p">)</span>  <span class="c1">#: Rx EQ optimization thread.</span>
    <span class="n">coopt_thread</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">CoOptThread</span><span class="p">)</span>  <span class="c1">#: EQ co-optimization thread.</span>

    <span class="c1"># - Tx</span>
    <span class="n">vod</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gVod</span><span class="p">)</span>  <span class="c1">#: Tx differential output voltage (V)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gRs</span><span class="p">)</span>  <span class="c1">#: Tx source impedance (Ohms)</span>
    <span class="n">cout</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gCout</span><span class="p">)</span>  <span class="c1">#: Tx parasitic output capacitance (pF)</span>
    <span class="n">pn_mag</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gPnMag</span><span class="p">)</span>  <span class="c1">#: Periodic noise magnitude (V).</span>
    <span class="n">pn_freq</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gPnFreq</span><span class="p">)</span>  <span class="c1">#: Periodic noise frequency (MHz).</span>
    <span class="n">rn</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gRn</span><span class="p">)</span>  <span class="c1">#: Standard deviation of Gaussian random noise (V).</span>
    <span class="n">tx_taps</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Pre-tap&quot;</span><span class="p">,</span>   <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Post-tap1&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Post-tap2&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">TxTapTuner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Post-tap3&quot;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>  <span class="c1">#: List of TxTapTuner objects.</span>
    <span class="n">rel_power</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1">#: Tx power dissipation (W).</span>
    <span class="n">tx_use_ami</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">tx_use_getwave</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">tx_has_getwave</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">tx_ami_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.ami&quot;</span><span class="p">])</span>  <span class="c1">#: (File)</span>
    <span class="n">tx_ami_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">tx_dll_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.dll&quot;</span><span class="p">,</span> <span class="s2">&quot;*.so&quot;</span><span class="p">])</span>  <span class="c1">#: (File)</span>
    <span class="n">tx_dll_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">tx_ibis_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IBIS Models (*.ibs)|*.ibs&quot;</span><span class="p">,])</span>  <span class="c1">#: (File)</span>
    <span class="n">tx_ibis_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">tx_use_ibis</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>

    <span class="c1"># - Rx</span>
    <span class="n">rin</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gRin</span><span class="p">)</span>  <span class="c1">#: Rx input impedance (Ohm)</span>
    <span class="n">cin</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gCin</span><span class="p">)</span>  <span class="c1">#: Rx parasitic input capacitance (pF)</span>
    <span class="n">cac</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gCac</span><span class="p">)</span>  <span class="c1">#: Rx a.c. coupling capacitance (uF)</span>
    <span class="n">use_ctle_file</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: For importing CTLE impulse/step response directly.</span>
    <span class="n">ctle_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.csv&quot;</span><span class="p">])</span>  <span class="c1">#: CTLE response file (when use_ctle_file = True).</span>
    <span class="n">rx_bw</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gBW</span><span class="p">)</span>  <span class="c1">#: CTLE bandwidth (GHz).</span>
    <span class="n">peak_freq</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gPeakFreq</span><span class="p">)</span>  <span class="c1">#: CTLE peaking frequency (GHz)</span>
    <span class="n">peak_mag</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gPeakMag</span><span class="p">)</span>  <span class="c1">#: CTLE peaking magnitude (dB)</span>
    <span class="n">ctle_offset</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gCTLEOffset</span><span class="p">)</span>  <span class="c1">#: CTLE d.c. offset (dB)</span>
    <span class="n">ctle_mode</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s2">&quot;Off&quot;</span><span class="p">,</span> <span class="s2">&quot;Passive&quot;</span><span class="p">,</span> <span class="s2">&quot;AGC&quot;</span><span class="p">,</span> <span class="s2">&quot;Manual&quot;</span><span class="p">)</span>  <span class="c1">#: CTLE mode (&#39;Off&#39;, &#39;Passive&#39;, &#39;AGC&#39;, &#39;Manual&#39;).</span>
    <span class="n">rx_use_ami</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">rx_use_getwave</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">rx_has_getwave</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">rx_ami_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.ami&quot;</span><span class="p">])</span>  <span class="c1">#: (File)</span>
    <span class="n">rx_ami_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">rx_dll_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.dll&quot;</span><span class="p">,</span> <span class="s2">&quot;*.so&quot;</span><span class="p">])</span>  <span class="c1">#: (File)</span>
    <span class="n">rx_dll_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">rx_ibis_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.ibs&quot;</span><span class="p">])</span>  <span class="c1">#: (File)</span>
    <span class="n">rx_ibis_valid</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>
    <span class="n">rx_use_ibis</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#: (Bool)</span>

    <span class="c1"># - DFE</span>
    <span class="n">use_dfe</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">gUseDfe</span><span class="p">)</span>  <span class="c1">#: True = use a DFE (Bool).</span>
    <span class="n">sum_ideal</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">gDfeIdeal</span><span class="p">)</span>  <span class="c1">#: True = use an ideal (i.e. - infinite bandwidth) summing node (Bool).</span>
    <span class="n">decision_scaler</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gDecisionScaler</span><span class="p">)</span>  <span class="c1">#: DFE slicer output voltage (V).</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gGain</span><span class="p">)</span>  <span class="c1">#: DFE error gain (unitless).</span>
    <span class="n">n_ave</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gNave</span><span class="p">)</span>  <span class="c1">#: DFE # of averages to take, before making tap corrections.</span>
    <span class="n">n_taps</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gNtaps</span><span class="p">)</span>  <span class="c1">#: DFE # of taps.</span>
    <span class="n">_old_n_taps</span> <span class="o">=</span> <span class="n">n_taps</span>
    <span class="n">sum_bw</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gDfeBW</span><span class="p">)</span>  <span class="c1">#: DFE summing node bandwidth (Used when sum_ideal=False.) (GHz).</span>

    <span class="c1"># - CDR</span>
    <span class="n">delta_t</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gDeltaT</span><span class="p">)</span>  <span class="c1">#: CDR proportional branch magnitude (ps).</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gAlpha</span><span class="p">)</span>  <span class="c1">#: CDR integral branch magnitude (unitless).</span>
    <span class="n">n_lock_ave</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gNLockAve</span><span class="p">)</span>  <span class="c1">#: CDR # of averages to take in determining lock.</span>
    <span class="n">rel_lock_tol</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">gRelLockTol</span><span class="p">)</span>  <span class="c1">#: CDR relative tolerance to use in determining lock.</span>
    <span class="n">lock_sustain</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gLockSustain</span><span class="p">)</span>  <span class="c1">#: CDR hysteresis to use in determining lock.</span>

    <span class="c1"># - Analysis</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">gThresh</span><span class="p">)</span>  <span class="c1">#: Threshold for identifying periodic jitter components (sigma).</span>

    <span class="c1"># Misc.</span>
    <span class="n">cfg_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.pybert_cfg&quot;</span><span class="p">])</span>  <span class="c1">#: PyBERT configuration data storage file (File).</span>
    <span class="n">data_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.pybert_data&quot;</span><span class="p">])</span>  <span class="c1">#: PyBERT results data storage file (File).</span>

    <span class="c1"># Plots (plot containers, actually)</span>
    <span class="n">plotdata</span> <span class="o">=</span> <span class="n">ArrayPlotData</span><span class="p">()</span>
    <span class="c1"># drawdata = ArrayPlotData()</span>
    <span class="n">plots_h</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_s</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_p</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_H</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_dfe</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_eye</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_jitter_dist</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_jitter_spec</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>
    <span class="n">plots_bathtub</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">GridPlotContainer</span><span class="p">)</span>

    <span class="c1"># Status</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="s2">&quot;Ready.&quot;</span><span class="p">)</span>  <span class="c1">#: PyBERT status (String).</span>
    <span class="n">jitter_perf</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">total_perf</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">sweep_results</span> <span class="o">=</span> <span class="n">List</span><span class="p">([])</span>
    <span class="n">len_h</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">chnl_dly</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1">#: Estimated channel delay (s).</span>
    <span class="n">bit_errs</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">#: # of bit errors observed in last run.</span>
    <span class="n">run_count</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Used as a mechanism to force bit stream regeneration.</span>

    <span class="c1"># About</span>
    <span class="n">ident</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span>
        <span class="s2">&quot;PyBERT v</span><span class="si">{}</span><span class="s2"> - a serial communication link design tool, written in Python.</span><span class="se">\n\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    </span><span class="si">{}</span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    </span><span class="si">{}</span><span class="se">\n\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    </span><span class="si">{}</span><span class="s2">;</span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    All rights reserved World wide.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">VERSION</span><span class="p">,</span> <span class="n">AUTHORS</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">COPY</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Help</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="n">help_str</span>

    <span class="c1"># Console</span>
    <span class="n">console_log</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="s2">&quot;PyBERT Console Log</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Dependent variables</span>
    <span class="c1"># - Handled by the Traits/UI machinery. (Should only contain &quot;low overhead&quot; variables, which don&#39;t freeze the GUI noticeably.)</span>
    <span class="c1">#</span>
    <span class="c1"># - Note: Don&#39;t make properties, which have a high calculation overhead, dependencies of other properties!</span>
    <span class="c1">#         This will slow the GUI down noticeably.</span>
    <span class="n">jitter_info</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">HTML</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;jitter_perf&quot;</span><span class="p">])</span>
    <span class="n">perf_info</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">HTML</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;total_perf&quot;</span><span class="p">])</span>
    <span class="n">status_str</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span>
    <span class="n">sweep_info</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">HTML</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sweep_results&quot;</span><span class="p">])</span>
    <span class="n">tx_h_tune</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tx_tap_tuners.value&quot;</span><span class="p">,</span> <span class="s2">&quot;nspui&quot;</span><span class="p">])</span>
    <span class="n">ctle_h_tune</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span>
        <span class="n">Array</span><span class="p">,</span>
        <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;peak_freq_tune&quot;</span><span class="p">,</span>
            <span class="s2">&quot;peak_mag_tune&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rx_bw_tune&quot;</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="s2">&quot;len_h&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ctle_mode_tune&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ctle_offset_tune&quot;</span><span class="p">,</span>
            <span class="s2">&quot;use_dfe_tune&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_taps_tune&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">ctle_out_h_tune</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tx_h_tune&quot;</span><span class="p">,</span> <span class="s2">&quot;ctle_h_tune&quot;</span><span class="p">,</span> <span class="s2">&quot;chnl_h&quot;</span><span class="p">])</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ctle_out_h_tune&quot;</span><span class="p">,</span> <span class="s2">&quot;nspui&quot;</span><span class="p">])</span>
    <span class="n">rel_opt</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;nspb&quot;</span><span class="p">,</span> <span class="s2">&quot;nbits&quot;</span><span class="p">])</span>
    <span class="n">t_ns</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">])</span>
    <span class="n">bits</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pattern_len&quot;</span><span class="p">,</span> <span class="s2">&quot;nbits&quot;</span><span class="p">,</span> <span class="s2">&quot;run_count&quot;</span><span class="p">])</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bits&quot;</span><span class="p">,</span> <span class="s2">&quot;mod_type&quot;</span><span class="p">,</span> <span class="s2">&quot;vod&quot;</span><span class="p">])</span>
    <span class="n">ffe</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tx_taps.value&quot;</span><span class="p">,</span> <span class="s2">&quot;tx_taps.enabled&quot;</span><span class="p">])</span>
    <span class="n">ui</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bit_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;mod_type&quot;</span><span class="p">])</span>
    <span class="n">nui</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nbits&quot;</span><span class="p">,</span> <span class="s2">&quot;mod_type&quot;</span><span class="p">])</span>
    <span class="n">nspui</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nspb&quot;</span><span class="p">,</span> <span class="s2">&quot;mod_type&quot;</span><span class="p">])</span>
    <span class="n">eye_uis</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eye_bits&quot;</span><span class="p">,</span> <span class="s2">&quot;mod_type&quot;</span><span class="p">])</span>
    <span class="n">dfe_out_p</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>
    <span class="n">przf_err</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dfe_out_p&quot;</span><span class="p">])</span>

    <span class="c1"># Custom buttons, which we&#39;ll use in particular tabs.</span>
    <span class="c1"># (Globally applicable buttons, such as &quot;Run&quot; and &quot;Ok&quot;, are handled more simply, in the View.)</span>
    <span class="n">btn_rst_eq</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;ResetEq&quot;</span><span class="p">)</span>
    <span class="n">btn_save_eq</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;SaveEq&quot;</span><span class="p">)</span>
    <span class="n">btn_opt_tx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;OptTx&quot;</span><span class="p">)</span>
    <span class="n">btn_opt_rx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;OptRx&quot;</span><span class="p">)</span>
    <span class="n">btn_coopt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;CoOpt&quot;</span><span class="p">)</span>
    <span class="n">btn_abort</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Abort&quot;</span><span class="p">)</span>
    <span class="n">btn_cfg_tx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Configure&quot;</span><span class="p">)</span>  <span class="c1"># Configure AMI parameters.</span>
    <span class="n">btn_cfg_rx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Configure&quot;</span><span class="p">)</span>
    <span class="n">btn_sel_tx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select&quot;</span><span class="p">)</span>     <span class="c1"># Select IBIS model.</span>
    <span class="n">btn_sel_rx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select&quot;</span><span class="p">)</span>
    <span class="n">btn_view_tx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">)</span>      <span class="c1"># View IBIS model.</span>
    <span class="n">btn_view_rx</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">)</span>

    <span class="c1"># Logger &amp; Pop-up</span>
<div class="viewcode-block" id="PyBERT.log"><a class="viewcode-back" href="../../modules.html#pybert.pybert.PyBERT.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log a message to the console and, optionally, to terminal and/or pop-up dialog.&quot;&quot;&quot;</span>
        <span class="n">_msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{}</span><span class="s2">]: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console_log</span> <span class="o">+=</span> <span class="n">txt</span>
        <span class="k">if</span> <span class="n">exception</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reraise</span><span class="p">:</span>  <span class="c1"># If we&#39;re in serious development debugging mode:</span>
            <span class="k">raise</span> <span class="n">exception</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="c1">## In case PyBERT crashes, before we can read this in its `Console` tab:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alert</span><span class="p">:</span>
            <span class="n">message</span><span class="p">(</span><span class="n">_msg</span><span class="p">,</span> <span class="s2">&quot;PyBERT Alert&quot;</span><span class="p">)</span></div>

    <span class="c1"># Default initialization</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_simulation</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initial plot setup occurs here.</span>

<span class="sd">        In order to populate the data structure we need to</span>
<span class="sd">        construct the plots, we must run the simulation.</span>

<span class="sd">        Args:</span>
<span class="sd">            run_simulation(Bool): If true, run the simulation, as part</span>
<span class="sd">                of class initialization. This is provided as an argument</span>
<span class="sd">                for the sake of larger applications, which may be</span>
<span class="sd">                importing PyBERT for its attributes and methods, and may</span>
<span class="sd">                not want to run the full simulation. (Optional;</span>
<span class="sd">                default = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Super-class initialization is ABSOLUTELY NECESSARY, in order</span>
        <span class="c1"># to get all the Traits/UI machinery setup correctly.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PyBERT</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Started.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Debug Mode Enabled.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">run_simulation</span><span class="p">:</span>
            <span class="c1"># Running the simulation will fill in the required data structure.</span>
            <span class="n">my_run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Once the required data structure is filled in, we can create the plots.</span>
            <span class="n">make_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_dfe_taps</span><span class="o">=</span><span class="n">gNtaps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_chnl_h</span><span class="p">()</span>  <span class="c1"># Prevents missing attribute error in _get_ctle_out_h_tune().</span>

    <span class="c1"># Custom button handlers</span>
    <span class="k">def</span> <span class="nf">_btn_rst_eq_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the equalization.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_freq_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_bw_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_bw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_offset_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_dfe_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_dfe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_taps_tune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_taps</span>

    <span class="k">def</span> <span class="nf">_btn_save_eq_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the equalization.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_freq_tune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag_tune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_bw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_bw_tune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode_tune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_offset_tune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_dfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_dfe_tune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_taps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_taps_tune</span>

    <span class="k">def</span> <span class="nf">_btn_opt_tx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">))])</span>
        <span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_opt_tx</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_do_opt_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_status</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span> <span class="o">=</span> <span class="n">TxOptThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">update_status</span> <span class="o">=</span> <span class="n">update_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_btn_opt_rx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode_tune</span> <span class="o">==</span> <span class="s2">&quot;Off&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span> <span class="o">=</span> <span class="n">RxOptThread</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span><span class="o">.</span><span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_btn_coopt_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span> <span class="o">=</span> <span class="n">CoOptThread</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span><span class="o">.</span><span class="n">pybert</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_btn_abort_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coopt_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_opt_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_opt_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_btn_cfg_tx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx_cfg</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_btn_cfg_rx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx_cfg</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_btn_sel_tx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_dll_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="o">.</span><span class="n">dll_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_ami_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="o">.</span><span class="n">ami_file</span>

    <span class="k">def</span> <span class="nf">_btn_sel_rx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_dll_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span><span class="o">.</span><span class="n">dll_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_ami_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span><span class="o">.</span><span class="n">ami_file</span>

    <span class="k">def</span> <span class="nf">_btn_view_tx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_btn_view_rx_fired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>

    <span class="c1"># Independent variable setting intercepts</span>
    <span class="c1"># (Primarily, for debugging.)</span>
    <span class="k">def</span> <span class="nf">_set_ctle_peak_mag_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">gMaxCTLEPeak</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;CTLE peak magnitude out of range!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag_tune</span> <span class="o">=</span> <span class="n">val</span>

    <span class="c1"># Dependent variable definitions</span>
    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the system time vector, in seconds.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span>
        <span class="n">nspui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
        <span class="n">nui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">ui</span> <span class="o">/</span> <span class="n">nspui</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">nui</span> <span class="o">*</span> <span class="n">nspui</span>

        <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">t0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">)])</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_t_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the system time vector, in ns.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1.0e9</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the frequency vector appropriate for indexing non-shifted FFT output, in Hz.</span>
<span class="sd">        # (i.e. - [0, f0, 2 * f0, ... , fN] + [-(fN - f0), -(fN - 2 * f0), ... , -f0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">npts</span><span class="p">)</span>
        <span class="n">half_npts</span> <span class="o">=</span> <span class="n">npts</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">f0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">half_npts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">half_npts</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">f0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">half_npts</span><span class="p">)])</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the frequency vector appropriate for indexing non-shifted FFT output, in rads./sec.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the bit stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pattern_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_len</span>
        <span class="n">nbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbits</span>
        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">bits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">seed</span><span class="p">:</span>  <span class="c1"># We don&#39;t want to seed our LFSR with zero.</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
        <span class="n">bit_gen</span> <span class="o">=</span> <span class="n">lfsr_bits</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">seed</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pattern_len</span> <span class="o">-</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">bit_gen</span><span class="p">))</span>

        <span class="c1"># The 4-bit prequels, below, are to ensure that the first zero crossing</span>
        <span class="c1"># in the actual slicer input signal occurs. This is necessary, because</span>
        <span class="c1"># we assume it does, when aligning the ideal and actual signals for</span>
        <span class="c1"># jitter calculation.</span>
        <span class="c1">#</span>
        <span class="c1"># We may want to talk to Mike Steinberger, of SiSoft, about his</span>
        <span class="c1"># correlation based approach to this alignment chore. It&#39;s</span>
        <span class="c1"># probably more robust.</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Duo-binary precodes, using XOR.</span>
            <span class="k">return</span> <span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bits</span><span class="p">),</span> <span class="n">nbits</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bits</span><span class="p">),</span> <span class="n">nbits</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the &quot;unit interval&quot; (i.e. - the nominal time span of each symbol moving through the channel).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bit_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_rate</span> <span class="o">*</span> <span class="mf">1.0e9</span>

        <span class="n">ui</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">bit_rate</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># PAM-4</span>
            <span class="n">ui</span> <span class="o">*=</span> <span class="mf">2.0</span>

        <span class="k">return</span> <span class="n">ui</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_nui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of unit intervals in the test vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbits</span>

        <span class="n">nui</span> <span class="o">=</span> <span class="n">nbits</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># PAM-4</span>
            <span class="n">nui</span> <span class="o">//=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">nui</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_nspui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of samples per unit interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nspb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspb</span>

        <span class="n">nspui</span> <span class="o">=</span> <span class="n">nspb</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># PAM-4</span>
            <span class="n">nspui</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">nspui</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_eye_uis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of unit intervals to use for eye construction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">eye_bits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_bits</span>

        <span class="n">eye_uis</span> <span class="o">=</span> <span class="n">eye_bits</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># PAM-4</span>
            <span class="n">eye_uis</span> <span class="o">//=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">eye_uis</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_ideal_h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ideal link impulse response.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span>
        <span class="n">nspui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ideal_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="k">if</span> <span class="n">ideal_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># delta</span>
            <span class="n">ideal_h</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">ideal_h</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">ideal_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># sinc</span>
            <span class="n">ideal_h</span> <span class="o">=</span> <span class="n">sinc</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">ui</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ideal_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># raised cosine</span>
            <span class="n">ideal_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">ui</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">ideal_h</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">ui</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="n">ideal_h</span><span class="p">)</span>
            <span class="n">ideal_h</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">ui</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="n">ideal_h</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;PyBERT._get_ideal_h(): ERROR: Unrecognized ideal impulse response type.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Duo-binary relies upon the total link impulse response to perform the required addition.</span>
            <span class="n">ideal_h</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ideal_h</span> <span class="o">+</span> <span class="n">pad</span><span class="p">(</span><span class="n">ideal_h</span><span class="p">[:</span><span class="o">-</span><span class="n">nspui</span><span class="p">],</span> <span class="p">(</span><span class="n">nspui</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">ideal_h</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the symbol stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vod</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bits</span>

        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># NRZ</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">bits</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Duo-binary</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># XOR pre-coding prevents infinite error propagation.</span>
                <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bit</span> <span class="o">^</span> <span class="n">symbols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">array</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># PAM-4</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">bits</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">bits</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bits</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bits</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ERROR: _get_symbols(): Unknown modulation type requested!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">*</span> <span class="n">vod</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_ffe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the Tx pre-emphasis FIR numerator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tap_tuners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span>

        <span class="n">taps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="n">tap_tuners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tuner</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                <span class="n">taps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuner</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">taps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">taps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">taps</span><span class="p">)))</span>  <span class="c1"># Assume one pre-tap.</span>

        <span class="k">return</span> <span class="n">taps</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_jitter_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">isi_chnl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isi_chnl</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">dcd_chnl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd_chnl</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">pj_chnl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pj_chnl</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">rj_chnl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rj_chnl</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">isi_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isi_tx</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">dcd_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd_tx</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">pj_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pj_tx</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">rj_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rj_tx</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">isi_ctle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isi_ctle</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">dcd_ctle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd_ctle</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">pj_ctle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pj_ctle</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">rj_ctle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rj_ctle</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">isi_dfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isi_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">dcd_dfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">pj_dfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pj_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span>
            <span class="n">rj_dfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rj_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span>

            <span class="n">isi_rej_tx</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">dcd_rej_tx</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">isi_rej_ctle</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">dcd_rej_ctle</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">pj_rej_ctle</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">rj_rej_ctle</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">isi_rej_dfe</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">dcd_rej_dfe</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">pj_rej_dfe</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">rj_rej_dfe</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">isi_rej_total</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">dcd_rej_total</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">pj_rej_total</span> <span class="o">=</span> <span class="mf">1.0e20</span>
            <span class="n">rj_rej_total</span> <span class="o">=</span> <span class="mf">1.0e20</span>

            <span class="k">if</span> <span class="n">isi_tx</span><span class="p">:</span>
                <span class="n">isi_rej_tx</span> <span class="o">=</span> <span class="n">isi_chnl</span> <span class="o">/</span> <span class="n">isi_tx</span>
            <span class="k">if</span> <span class="n">dcd_tx</span><span class="p">:</span>
                <span class="n">dcd_rej_tx</span> <span class="o">=</span> <span class="n">dcd_chnl</span> <span class="o">/</span> <span class="n">dcd_tx</span>
            <span class="k">if</span> <span class="n">isi_ctle</span><span class="p">:</span>
                <span class="n">isi_rej_ctle</span> <span class="o">=</span> <span class="n">isi_tx</span> <span class="o">/</span> <span class="n">isi_ctle</span>
            <span class="k">if</span> <span class="n">dcd_ctle</span><span class="p">:</span>
                <span class="n">dcd_rej_ctle</span> <span class="o">=</span> <span class="n">dcd_tx</span> <span class="o">/</span> <span class="n">dcd_ctle</span>
            <span class="k">if</span> <span class="n">pj_ctle</span><span class="p">:</span>
                <span class="n">pj_rej_ctle</span> <span class="o">=</span> <span class="n">pj_tx</span> <span class="o">/</span> <span class="n">pj_ctle</span>
            <span class="k">if</span> <span class="n">rj_ctle</span><span class="p">:</span>
                <span class="n">rj_rej_ctle</span> <span class="o">=</span> <span class="n">rj_tx</span> <span class="o">/</span> <span class="n">rj_ctle</span>
            <span class="k">if</span> <span class="n">isi_dfe</span><span class="p">:</span>
                <span class="n">isi_rej_dfe</span> <span class="o">=</span> <span class="n">isi_ctle</span> <span class="o">/</span> <span class="n">isi_dfe</span>
            <span class="k">if</span> <span class="n">dcd_dfe</span><span class="p">:</span>
                <span class="n">dcd_rej_dfe</span> <span class="o">=</span> <span class="n">dcd_ctle</span> <span class="o">/</span> <span class="n">dcd_dfe</span>
            <span class="k">if</span> <span class="n">pj_dfe</span><span class="p">:</span>
                <span class="n">pj_rej_dfe</span> <span class="o">=</span> <span class="n">pj_ctle</span> <span class="o">/</span> <span class="n">pj_dfe</span>
            <span class="k">if</span> <span class="n">rj_dfe</span><span class="p">:</span>
                <span class="n">rj_rej_dfe</span> <span class="o">=</span> <span class="n">rj_ctle</span> <span class="o">/</span> <span class="n">rj_dfe</span>
            <span class="k">if</span> <span class="n">isi_dfe</span><span class="p">:</span>
                <span class="n">isi_rej_total</span> <span class="o">=</span> <span class="n">isi_chnl</span> <span class="o">/</span> <span class="n">isi_dfe</span>
            <span class="k">if</span> <span class="n">dcd_dfe</span><span class="p">:</span>
                <span class="n">dcd_rej_total</span> <span class="o">=</span> <span class="n">dcd_chnl</span> <span class="o">/</span> <span class="n">dcd_dfe</span>
            <span class="k">if</span> <span class="n">pj_dfe</span><span class="p">:</span>
                <span class="n">pj_rej_total</span> <span class="o">=</span> <span class="n">pj_tx</span> <span class="o">/</span> <span class="n">pj_dfe</span>
            <span class="k">if</span> <span class="n">rj_dfe</span><span class="p">:</span>
                <span class="n">rj_rej_total</span> <span class="o">=</span> <span class="n">rj_tx</span> <span class="o">/</span> <span class="n">rj_dfe</span>

            <span class="n">info_str</span> <span class="o">=</span> <span class="s2">&quot;&lt;H1&gt;Jitter Rejection by Equalization Component&lt;/H1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;H2&gt;Tx Preemphasis&lt;/H2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TABLE border=&quot;1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;TH&gt;Jitter Component&lt;/TH&gt;&lt;TH&gt;Input (ps)&lt;/TH&gt;&lt;TH&gt;Output (ps)&lt;/TH&gt;&lt;TH&gt;Rejection (dB)&lt;/TH&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;ISI&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">isi_chnl</span><span class="p">,</span>
                <span class="n">isi_tx</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">isi_rej_tx</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;DCD&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">dcd_chnl</span><span class="p">,</span>
                <span class="n">dcd_tx</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">dcd_rej_tx</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Pj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;n/a&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pj_chnl</span><span class="p">,</span> <span class="n">pj_tx</span><span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Rj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;n/a&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rj_chnl</span><span class="p">,</span> <span class="n">rj_tx</span><span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TABLE&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;H2&gt;CTLE (+ AMI DFE)&lt;/H2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TABLE border=&quot;1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;TH&gt;Jitter Component&lt;/TH&gt;&lt;TH&gt;Input (ps)&lt;/TH&gt;&lt;TH&gt;Output (ps)&lt;/TH&gt;&lt;TH&gt;Rejection (dB)&lt;/TH&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;ISI&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">isi_tx</span><span class="p">,</span>
                <span class="n">isi_ctle</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">isi_rej_ctle</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;DCD&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">dcd_tx</span><span class="p">,</span>
                <span class="n">dcd_ctle</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">dcd_rej_ctle</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Pj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">pj_tx</span><span class="p">,</span>
                <span class="n">pj_ctle</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">pj_rej_ctle</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Rj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">rj_tx</span><span class="p">,</span>
                <span class="n">rj_ctle</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">rj_rej_ctle</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TABLE&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;H2&gt;DFE&lt;/H2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TABLE border=&quot;1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;TH&gt;Jitter Component&lt;/TH&gt;&lt;TH&gt;Input (ps)&lt;/TH&gt;&lt;TH&gt;Output (ps)&lt;/TH&gt;&lt;TH&gt;Rejection (dB)&lt;/TH&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;ISI&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">isi_ctle</span><span class="p">,</span>
                <span class="n">isi_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">isi_rej_dfe</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;DCD&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">dcd_ctle</span><span class="p">,</span>
                <span class="n">dcd_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">dcd_rej_dfe</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Pj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">pj_ctle</span><span class="p">,</span>
                <span class="n">pj_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">pj_rej_dfe</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Rj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">rj_ctle</span><span class="p">,</span>
                <span class="n">rj_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">rj_rej_dfe</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TABLE&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;H2&gt;TOTAL&lt;/H2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TABLE border=&quot;1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;TH&gt;Jitter Component&lt;/TH&gt;&lt;TH&gt;Input (ps)&lt;/TH&gt;&lt;TH&gt;Output (ps)&lt;/TH&gt;&lt;TH&gt;Rejection (dB)&lt;/TH&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;ISI&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">isi_chnl</span><span class="p">,</span>
                <span class="n">isi_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">isi_rej_total</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;DCD&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">dcd_chnl</span><span class="p">,</span>
                <span class="n">dcd_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">dcd_rej_total</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Pj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">pj_tx</span><span class="p">,</span>
                <span class="n">pj_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">pj_rej_total</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;&lt;TD align=&quot;center&quot;&gt;Rj&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%4.1f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">rj_tx</span><span class="p">,</span>
                <span class="n">rj_dfe</span><span class="p">,</span>
                <span class="mf">10.0</span> <span class="o">*</span> <span class="n">safe_log10</span><span class="p">(</span><span class="n">rj_rej_total</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/TABLE&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">info_str</span> <span class="o">=</span> <span class="s2">&quot;&lt;H1&gt;Jitter Rejection by Equalization Component&lt;/H1&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;Sorry, an error occurred.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">info_str</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_perf_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info_str</span> <span class="o">=</span> <span class="s2">&quot;&lt;H2&gt;Performance by Component&lt;/H2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;  &lt;TABLE border=&quot;1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;      &lt;TH&gt;Component&lt;/TH&gt;&lt;TH&gt;Performance (Msmpls./min.)&lt;/TH&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;Channel&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;Tx Preemphasis&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;CTLE&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctle_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;DFE&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfe_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;Jitter Analysis&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;&lt;strong&gt;TOTAL&lt;/strong&gt;&lt;/TD&gt;&lt;TD&gt;&lt;strong&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/strong&gt;&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span>
        <span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;right&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;      &lt;TD align=&quot;center&quot;&gt;Plotting&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%6.3f</span><span class="s1">&lt;/TD&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;  &lt;/TABLE&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">info_str</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_sweep_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sweep_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_results</span>

        <span class="n">info_str</span> <span class="o">=</span> <span class="s2">&quot;&lt;H2&gt;Sweep Results&lt;/H2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;  &lt;TABLE border=&quot;1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;      &lt;TH&gt;Pretap&lt;/TH&gt;&lt;TH&gt;Posttap&lt;/TH&gt;&lt;TH&gt;Mean(bit errors)&lt;/TH&gt;&lt;TH&gt;StdDev(bit errors)&lt;/TH&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sweep_results</span><span class="p">:</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;TR align=&quot;center&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;      &lt;TD&gt;</span><span class="si">%+06.3f</span><span class="s2">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%+06.3f</span><span class="s2">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%d</span><span class="s2">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">%d</span><span class="s2">&lt;/TD&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/TR&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">info_str</span> <span class="o">+=</span> <span class="s2">&quot;  &lt;/TABLE&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">info_str</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_status_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">status_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%-20s</span><span class="s2"> | Perf. (Msmpls./min.):  </span><span class="si">%4.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_perf</span> <span class="o">*</span> <span class="mf">60.0e-6</span><span class="p">)</span>
        <span class="n">dly_str</span> <span class="o">=</span> <span class="s2">&quot;         | ChnlDly (ns):    </span><span class="si">%5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chnl_dly</span> <span class="o">*</span> <span class="mf">1.0e9</span><span class="p">)</span>
        <span class="n">err_str</span> <span class="o">=</span> <span class="s2">&quot;         | BitErrs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_errs</span>
        <span class="n">pwr_str</span> <span class="o">=</span> <span class="s2">&quot;         | TxPwr (W): </span><span class="si">%4.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_power</span>
        <span class="n">status_str</span> <span class="o">+=</span> <span class="n">dly_str</span> <span class="o">+</span> <span class="n">err_str</span> <span class="o">+</span> <span class="n">pwr_str</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">jit_str</span> <span class="o">=</span> <span class="s2">&quot;         | Jitter (ps):    ISI=</span><span class="si">%6.3f</span><span class="s2">    DCD=</span><span class="si">%6.3f</span><span class="s2">    Pj=</span><span class="si">%6.3f</span><span class="s2">    Rj=</span><span class="si">%6.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isi_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dcd_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pj_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rj_dfe</span> <span class="o">*</span> <span class="mf">1.0e12</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">jit_str</span> <span class="o">=</span> <span class="s2">&quot;         | (Jitter not available.)&quot;</span>

        <span class="n">status_str</span> <span class="o">+=</span> <span class="n">jit_str</span>

        <span class="k">return</span> <span class="n">status_str</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_tx_h_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nspui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
        <span class="n">tap_tuners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span>

        <span class="n">taps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="n">tap_tuners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tuner</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                <span class="n">taps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuner</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">taps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">taps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">taps</span><span class="p">)))</span>  <span class="c1"># Assume one pre-tap.</span>

        <span class="n">h</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="n">nspui</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">taps</span><span class="p">],</span> <span class="p">[])</span>

        <span class="k">return</span> <span class="n">h</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_ctle_h_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">len_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_h</span>
        <span class="n">rx_bw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_bw_tune</span> <span class="o">*</span> <span class="mf">1.0e9</span>
        <span class="n">peak_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_freq_tune</span> <span class="o">*</span> <span class="mf">1.0e9</span>
        <span class="n">peak_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag_tune</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_offset_tune</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode_tune</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">make_ctle</span><span class="p">(</span><span class="n">rx_bw</span><span class="p">,</span> <span class="n">peak_freq</span><span class="p">,</span> <span class="n">peak_mag</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">H</span><span class="p">))[:</span><span class="n">len_h</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">*=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">h</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_ctle_out_h_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">chnl_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chnl_h</span>
        <span class="n">tx_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_h_tune</span>
        <span class="n">ctle_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_h_tune</span>

        <span class="n">tx_out_h</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">tx_h</span><span class="p">,</span> <span class="n">chnl_h</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">,</span> <span class="n">tx_out_h</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">h</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nspui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_h_tune</span>
        <span class="n">mod_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">pad</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="n">nspui</span><span class="p">],</span> <span class="p">(</span><span class="n">nspui</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="p">(</span><span class="n">clock_pos</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span> <span class="o">=</span> <span class="n">pulse_center</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">nspui</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clock_pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>  <span class="c1"># Returning a large cost lets it know it took a wrong turn.</span>
        <span class="n">clocks</span> <span class="o">=</span> <span class="n">thresh</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Handle duo-binary.</span>
            <span class="n">clock_pos</span> <span class="o">-=</span> <span class="n">nspui</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">clocks</span><span class="p">[</span><span class="n">clock_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Handle duo-binary.</span>
            <span class="n">clocks</span><span class="p">[</span><span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Cost is simply ISI minus main lobe amplitude.</span>
        <span class="c1"># Note: post-cursor ISI is NOT included in cost, when we&#39;re using the DFE.</span>
        <span class="n">isi</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">clock_pos</span> <span class="o">-</span> <span class="n">nspui</span>
        <span class="k">while</span> <span class="n">ix</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">clocks</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">isi</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
            <span class="n">ix</span> <span class="o">-=</span> <span class="n">nspui</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span>
        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Handle duo-binary.</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="n">nspui</span>
        <span class="k">while</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="n">clocks</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_dfe_tune</span><span class="p">:</span>
                <span class="n">isi</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="n">nspui</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_dfe_tune</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_taps_tune</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="n">p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span> <span class="p">:]</span> <span class="o">-=</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_out_h_tune&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;clocks_tune&quot;</span><span class="p">,</span> <span class="n">clocks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Handle duo-binary.</span>
            <span class="k">return</span> <span class="n">isi</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span> <span class="o">+</span> <span class="n">nspui</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">isi</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_rel_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_przf_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_p</span>
        <span class="n">nspui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
        <span class="n">n_taps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_taps</span>

        <span class="p">(</span><span class="n">clock_pos</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">pulse_center</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">nspui</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_taps</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nspui</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">err</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="n">clock_pos</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="c1"># Changed property handlers.</span>
    <span class="k">def</span> <span class="nf">_status_str_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gDebugStatus</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_use_dfe_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_value</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_use_dfe_tune_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_value</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tx_tap_tuners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_tx_ibis_file_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_ibis_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">ibis</span> <span class="o">=</span> <span class="n">IBISModel</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parsing Tx IBIS file, &#39;</span><span class="si">{}</span><span class="s2">&#39;...</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">ibis</span><span class="o">.</span><span class="n">ibis_parsing_errors</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span> <span class="o">=</span> <span class="n">ibis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_ibis_valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_dll_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="o">.</span><span class="n">dll_file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_ami_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="o">.</span><span class="n">ami_file</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Failed to open and/or parse IBIS file!</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">err</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tx_ami_file_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_ami_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span> <span class="k">as</span> <span class="n">pfile</span><span class="p">:</span>
                <span class="n">pcfg</span> <span class="o">=</span> <span class="n">AMIParamConfigurator</span><span class="p">(</span><span class="n">pfile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parsing Tx AMI file, &#39;</span><span class="si">{}</span><span class="s2">&#39;...</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">pcfg</span><span class="o">.</span><span class="n">ami_parsing_errors</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_has_getwave</span> <span class="o">=</span> <span class="n">pcfg</span><span class="o">.</span><span class="n">fetch_param_val</span><span class="p">([</span><span class="s2">&quot;Reserved_Parameters&quot;</span><span class="p">,</span> <span class="s2">&quot;GetWave_Exists&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tx_cfg</span> <span class="o">=</span> <span class="n">pcfg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_ami_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Failed to open and/or parse AMI file!</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tx_dll_file_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_dll_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">AMIModel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tx_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_dll_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Failed to open DLL/SO file!</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rx_ibis_file_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_ibis_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">ibis</span> <span class="o">=</span> <span class="n">IBISModel</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parsing Rx IBIS file, &#39;</span><span class="si">{}</span><span class="s2">&#39;...</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">ibis</span><span class="o">.</span><span class="n">ibis_parsing_errors</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span> <span class="o">=</span> <span class="n">ibis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_ibis_valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_dll_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span><span class="o">.</span><span class="n">dll_file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_ami_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx_ibis</span><span class="o">.</span><span class="n">ami_file</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Failed to open and/or parse IBIS file!</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rx_ami_file_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_ami_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span> <span class="k">as</span> <span class="n">pfile</span><span class="p">:</span>
                <span class="n">pcfg</span> <span class="o">=</span> <span class="n">AMIParamConfigurator</span><span class="p">(</span><span class="n">pfile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parsing Rx AMI file, &#39;</span><span class="si">{}</span><span class="s2">&#39;...</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">pcfg</span><span class="o">.</span><span class="n">ami_parsing_errors</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_has_getwave</span> <span class="o">=</span> <span class="n">pcfg</span><span class="o">.</span><span class="n">fetch_param_val</span><span class="p">([</span><span class="s2">&quot;Reserved_Parameters&quot;</span><span class="p">,</span> <span class="s2">&quot;GetWave_Exists&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rx_cfg</span> <span class="o">=</span> <span class="n">pcfg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_ami_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Failed to open and/or parse AMI file!</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rx_dll_file_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_dll_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">AMIModel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rx_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx_dll_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Failed to open DLL/SO file!</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">alert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># This function has been pulled outside of the standard Traits/UI &quot;depends_on / @cached_property&quot; mechanism,</span>
    <span class="c1"># in order to more tightly control when it executes. I wasn&#39;t able to get truly lazy evaluation, and</span>
    <span class="c1"># this was causing noticeable GUI slowdown.</span>
<div class="viewcode-block" id="PyBERT.calc_chnl_h"><a class="viewcode-back" href="../../modules.html#pybert.pybert.PyBERT.calc_chnl_h">[docs]</a>    <span class="k">def</span> <span class="nf">calc_chnl_h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the channel impulse response.</span>

<span class="sd">        Also sets, in &#39;self&#39;:</span>
<span class="sd">         - chnl_dly:</span>
<span class="sd">             group delay of channel</span>
<span class="sd">         - start_ix:</span>
<span class="sd">             first element of trimmed response</span>
<span class="sd">         - t_ns_chnl:</span>
<span class="sd">             the x-values, in ns, for plotting &#39;chnl_h&#39;</span>
<span class="sd">         - chnl_H:</span>
<span class="sd">             channel frequency response</span>
<span class="sd">         - chnl_s:</span>
<span class="sd">             channel step response</span>
<span class="sd">         - chnl_p:</span>
<span class="sd">             channel pulse response</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nspui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
        <span class="n">impulse_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impulse_length</span> <span class="o">*</span> <span class="mf">1.0e-9</span>
        <span class="n">Rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span>
        <span class="n">Cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cout</span> <span class="o">*</span> <span class="mf">1.0e-12</span>
        <span class="n">RL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rin</span>
        <span class="n">Cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cin</span> <span class="o">*</span> <span class="mf">1.0e-12</span>
        <span class="n">CL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cac</span> <span class="o">*</span> <span class="mf">1.0e-6</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_use_ibis</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_ibis</span><span class="o">.</span><span class="n">model</span>
            <span class="n">Rs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">zout</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">Cs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">ccomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ch_file</span><span class="p">:</span>
            <span class="n">Zref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zref</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">import_channel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_file</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">padded</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>  <span class="c1"># step response?</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># impulse response is derivative of step response.</span>
            <span class="n">h</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># Normalize d.c. to one.</span>
            <span class="n">chnl_dly</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">where</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">h</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">chnl_H</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">calc_G</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">Cs</span><span class="p">,</span> <span class="n">Zref</span><span class="p">,</span> <span class="n">RL</span><span class="p">,</span> <span class="n">Cp</span><span class="p">,</span> <span class="n">CL</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>  <span class="c1"># Compensating for nominal /2 divider action.</span>
            <span class="n">chnl_h</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">chnl_H</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l_ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_ch</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">*</span> <span class="mf">3.0e8</span>
            <span class="n">R0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R0</span>
            <span class="n">w0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w0</span>
            <span class="n">Rdc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rdc</span>
            <span class="n">Z0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z0</span>
            <span class="n">Theta0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Theta0</span>
            <span class="n">gamma</span><span class="p">,</span> <span class="n">Zc</span> <span class="o">=</span> <span class="n">calc_gamma</span><span class="p">(</span><span class="n">R0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">Rdc</span><span class="p">,</span> <span class="n">Z0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">Theta0</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">l_ch</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span>
            <span class="n">chnl_H</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">calc_G</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">Cs</span><span class="p">,</span> <span class="n">Zc</span><span class="p">,</span> <span class="n">RL</span><span class="p">,</span> <span class="n">Cp</span><span class="p">,</span> <span class="n">CL</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>  <span class="c1"># Compensating for nominal /2 divider action.</span>
            <span class="n">chnl_h</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">chnl_H</span><span class="p">))</span>
            <span class="n">chnl_dly</span> <span class="o">=</span> <span class="n">l_ch</span> <span class="o">/</span> <span class="n">v0</span>

        <span class="n">min_len</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">nspui</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">nspui</span>
        <span class="k">if</span> <span class="n">impulse_length</span><span class="p">:</span>
            <span class="n">min_len</span> <span class="o">=</span> <span class="n">max_len</span> <span class="o">=</span> <span class="n">impulse_length</span> <span class="o">/</span> <span class="n">ts</span>
        <span class="n">chnl_h</span><span class="p">,</span> <span class="n">start_ix</span> <span class="o">=</span> <span class="n">trim_impulse</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="n">max_len</span><span class="p">)</span>
        <span class="n">chnl_h</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)</span>  <span class="c1"># a temporary crutch.</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">chnl_h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">chnl_trimmed_H</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

        <span class="n">chnl_s</span> <span class="o">=</span> <span class="n">chnl_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">chnl_p</span> <span class="o">=</span> <span class="n">chnl_s</span> <span class="o">-</span> <span class="n">pad</span><span class="p">(</span><span class="n">chnl_s</span><span class="p">[:</span><span class="o">-</span><span class="n">nspui</span><span class="p">],</span> <span class="p">(</span><span class="n">nspui</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chnl_h</span> <span class="o">=</span> <span class="n">chnl_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len_h</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chnl_dly</span> <span class="o">=</span> <span class="n">chnl_dly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chnl_H</span> <span class="o">=</span> <span class="n">chnl_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chnl_trimmed_H</span> <span class="o">=</span> <span class="n">chnl_trimmed_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_ix</span> <span class="o">=</span> <span class="n">start_ix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_ns_chnl</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">start_ix</span> <span class="p">:</span> <span class="n">start_ix</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)])</span> <span class="o">*</span> <span class="mf">1.0e9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chnl_s</span> <span class="o">=</span> <span class="n">chnl_s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chnl_p</span> <span class="o">=</span> <span class="n">chnl_p</span>

        <span class="k">return</span> <span class="n">chnl_h</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">PyBERT</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">General description of <em>pybert</em> package.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Modules in <em>pybert</em> package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, David Banas.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>