<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pybert.pybert_cntrl &#8212; PyBERT 2.4.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pybert.pybert_cntrl</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Default controller definition for PyBERT class.</span>

<span class="sd">Original author: David Banas &lt;capn.freako@gmail.com&gt;  </span>

<span class="sd">Original date:   August 24, 2014 (Copied from pybert.py, as part of a major code cleanup.)</span>

<span class="sd">Copyright (c) 2014 David Banas; all rights reserved World wide.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">time</span>         <span class="k">import</span> <span class="n">clock</span><span class="p">,</span> <span class="n">sleep</span>

<span class="kn">from</span> <span class="nn">chaco.api</span>       <span class="k">import</span> <span class="n">Plot</span>
<span class="kn">from</span> <span class="nn">chaco.tools.api</span> <span class="k">import</span> <span class="n">PanTool</span><span class="p">,</span> <span class="n">ZoomTool</span>

<span class="kn">from</span> <span class="nn">numpy</span>        <span class="k">import</span> <span class="n">sign</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">repeat</span>
<span class="kn">from</span> <span class="nn">numpy</span>        <span class="k">import</span> <span class="n">where</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="n">square</span><span class="p">,</span> <span class="n">shape</span>
<span class="kn">from</span> <span class="nn">numpy</span>        <span class="k">import</span> <span class="n">diff</span><span class="p">,</span> <span class="n">log10</span><span class="p">,</span> <span class="n">correlate</span><span class="p">,</span> <span class="n">convolve</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">resize</span><span class="p">,</span> <span class="n">real</span>
<span class="kn">from</span> <span class="nn">numpy</span>        <span class="k">import</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">cumsum</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">concatenate</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="n">normal</span>
<span class="kn">from</span> <span class="nn">numpy.fft</span>    <span class="k">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span>
<span class="kn">from</span> <span class="nn">scipy</span>        <span class="k">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">lfilter</span><span class="p">,</span> <span class="n">iirfilter</span><span class="p">,</span> <span class="n">freqz</span><span class="p">,</span> <span class="n">fftconvolve</span>

<span class="kn">from</span> <span class="nn">dfe</span>          <span class="k">import</span> <span class="n">DFE</span>
<span class="kn">from</span> <span class="nn">cdr</span>          <span class="k">import</span> <span class="n">CDR</span>

<span class="kn">from</span> <span class="nn">pyibisami.amimodel</span> <span class="k">import</span> <span class="n">AMIModel</span><span class="p">,</span> <span class="n">AMIModelInitializer</span>
<span class="kn">from</span> <span class="nn">pybert_util</span>  <span class="k">import</span> <span class="n">find_crossings</span><span class="p">,</span> <span class="n">make_ctle</span><span class="p">,</span> <span class="n">calc_jitter</span><span class="p">,</span> <span class="n">moving_average</span><span class="p">,</span> <span class="n">calc_eye</span><span class="p">,</span> <span class="n">import_channel</span>

<span class="n">DEBUG</span>           <span class="o">=</span> <span class="kc">False</span>
<span class="n">MIN_BATHTUB_VAL</span> <span class="o">=</span> <span class="mf">1.e-18</span>

<span class="n">gFc</span>     <span class="o">=</span> <span class="mf">1.e6</span>     <span class="c1"># Corner frequency of high-pass filter used to model capacitive coupling of periodic noise.</span>

<div class="viewcode-block" id="my_run_sweeps"><a class="viewcode-back" href="../../modules.html#pybert.pybert_cntrl.my_run_sweeps">[docs]</a><span class="k">def</span> <span class="nf">my_run_sweeps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the simulation sweeps.</span>

<span class="sd">    Args:</span>
<span class="sd">        self(PyBERT): Reference to an instance of the *PyBERT* class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sweep_aves</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_aves</span>
    <span class="n">do_sweep</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_sweep</span>
    <span class="n">tx_taps</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span>

    <span class="k">if</span><span class="p">(</span><span class="n">do_sweep</span><span class="p">):</span>
        <span class="c1"># Assemble the list of desired values for each sweepable parameter.</span>
        <span class="n">sweep_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tap</span> <span class="ow">in</span> <span class="n">tx_taps</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">tap</span><span class="o">.</span><span class="n">enabled</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">tap</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
                    <span class="n">sweep_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">tap</span><span class="o">.</span><span class="n">min_val</span><span class="p">,</span> <span class="n">tap</span><span class="o">.</span><span class="n">max_val</span><span class="p">,</span> <span class="p">(</span><span class="n">tap</span><span class="o">.</span><span class="n">max_val</span> <span class="o">-</span> <span class="n">tap</span><span class="o">.</span><span class="n">min_val</span><span class="p">)</span> <span class="o">/</span> <span class="n">tap</span><span class="o">.</span><span class="n">steps</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sweep_vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tap</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sweep_vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>
        <span class="c1"># Run the sweep, using the lists assembled, above.</span>
        <span class="n">sweeps</span> <span class="o">=</span> <span class="p">[[</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">sweep_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sweep_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">sweep_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">sweep_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                 <span class="p">]</span>
        <span class="n">num_sweeps</span>      <span class="o">=</span> <span class="n">sweep_aves</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sweeps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_sweeps</span> <span class="o">=</span> <span class="n">num_sweeps</span>
        <span class="n">sweep_results</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sweep_num</span>       <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">sweeps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tx_taps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">sweep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">bit_errs</span>       <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sweep_aves</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sweep_num</span> <span class="o">=</span> <span class="n">sweep_num</span>
                <span class="n">my_run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">bit_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_errs</span><span class="p">)</span>
                <span class="n">sweep_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sweep_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sweep</span><span class="p">,</span> <span class="n">mean</span><span class="p">(</span><span class="n">bit_errs</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">bit_errs</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_results</span> <span class="o">=</span> <span class="n">sweep_results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="my_run_simulation"><a class="viewcode-back" href="../../modules.html#pybert.pybert_cntrl.my_run_simulation">[docs]</a><span class="k">def</span> <span class="nf">my_run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">update_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the simulation.</span>

<span class="sd">    Args:</span>
<span class="sd">        self(PyBERT): Reference to an instance of the *PyBERT* class.</span>
<span class="sd">        initial_run(Bool): If True, don&#39;t update the eye diagrams, since</span>
<span class="sd">            they haven&#39;t been created, yet. (Optional; default = False.)</span>
<span class="sd">        update_plots(Bool): If True, update the plots, after simulation</span>
<span class="sd">            completes. This option can be used by larger scripts, which</span>
<span class="sd">            import *pybert*, in order to avoid graphical back-end</span>
<span class="sd">            conflicts and speed up this function&#39;s execution time.</span>
<span class="sd">            (Optional; default = True.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_sweeps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sweeps</span>
    <span class="n">sweep_num</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_num</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Running channel...(sweep </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sweep_num</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">run_count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Force regeneration of bit stream.</span>

    <span class="c1"># Pull class variables into local storage, performing unit conversion where necessary.</span>
    <span class="n">t</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
    <span class="n">t_ns</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_ns</span>
    <span class="n">f</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
    <span class="n">w</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
    <span class="n">bits</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bits</span>
    <span class="n">symbols</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
    <span class="n">ffe</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffe</span>
    <span class="n">nbits</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbits</span>
    <span class="n">nui</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span>
    <span class="n">bit_rate</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_rate</span> <span class="o">*</span> <span class="mf">1.e9</span>
    <span class="n">eye_bits</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_bits</span>
    <span class="n">eye_uis</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_uis</span>
    <span class="n">nspb</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspb</span>
    <span class="n">nspui</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
    <span class="n">rn</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rn</span>
    <span class="n">pn_mag</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pn_mag</span>
    <span class="n">pn_freq</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pn_freq</span> <span class="o">*</span> <span class="mf">1.e6</span>
    <span class="n">Vod</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vod</span>
    <span class="n">Rs</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span>
    <span class="n">Cs</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cout</span> <span class="o">*</span> <span class="mf">1.e-12</span>
    <span class="n">RL</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rin</span>
    <span class="n">CL</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cac</span> <span class="o">*</span> <span class="mf">1.e-6</span>
    <span class="n">Cp</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cin</span> <span class="o">*</span> <span class="mf">1.e-12</span>
    <span class="n">R0</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R0</span>
    <span class="n">w0</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w0</span>
    <span class="n">Rdc</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rdc</span>
    <span class="n">Z0</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z0</span>
    <span class="n">v0</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">*</span> <span class="mf">3.e8</span>
    <span class="n">Theta0</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Theta0</span>
    <span class="n">l_ch</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_ch</span>
    <span class="n">pattern_len</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_len</span>
    <span class="n">rx_bw</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_bw</span> <span class="o">*</span> <span class="mf">1.e9</span>
    <span class="n">peak_freq</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_freq</span> <span class="o">*</span> <span class="mf">1.e9</span>
    <span class="n">peak_mag</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_mag</span>
    <span class="n">ctle_offset</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_offset</span>
    <span class="n">ctle_mode</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode</span>
    <span class="n">delta_t</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_t</span> <span class="o">*</span> <span class="mf">1.e-12</span>
    <span class="n">alpha</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
    <span class="n">ui</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span>
    <span class="n">n_taps</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_taps</span>
    <span class="n">gain</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain</span>
    <span class="n">n_ave</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_ave</span>
    <span class="n">decision_scaler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision_scaler</span>
    <span class="n">n_lock_ave</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_lock_ave</span>
    <span class="n">rel_lock_tol</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_lock_tol</span>
    <span class="n">lock_sustain</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_sustain</span>
    <span class="n">bandwidth</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_bw</span> <span class="o">*</span> <span class="mf">1.e9</span>
    <span class="n">rel_thresh</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresh</span>
    <span class="n">mod_type</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Calculate misc. values.</span>
        <span class="n">fs</span>         <span class="o">=</span> <span class="n">bit_rate</span> <span class="o">*</span> <span class="n">nspb</span>
        <span class="n">Ts</span>         <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ts</span>         <span class="o">=</span> <span class="n">Ts</span>

        <span class="c1"># Generate the ideal over-sampled signal.</span>
        <span class="c1">#</span>
        <span class="c1"># Duo-binary is problematic, in that it requires convolution with the ideal duobinary</span>
        <span class="c1"># impulse response, in order to produce the proper ideal signal.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">nspui</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Handle duo-binary case.</span>
            <span class="n">duob_h</span> <span class="o">=</span> <span class="n">array</span><span class="p">(([</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nspui</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">duob_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_signal</span> <span class="o">=</span> <span class="n">x</span>

        <span class="c1"># Find the ideal crossing times, for subsequent jitter analysis of transmitted signal.</span>
        <span class="n">ideal_xings</span> <span class="o">=</span> <span class="n">find_crossings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">min_delay</span><span class="o">=</span><span class="p">(</span><span class="n">ui</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">),</span> <span class="n">mod_type</span><span class="o">=</span><span class="n">mod_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_xings</span> <span class="o">=</span> <span class="n">ideal_xings</span>

        <span class="c1"># Calculate the channel output.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: We&#39;re not using &#39;self.ideal_signal&#39;, because we rely on the system response to</span>
        <span class="c1">#       create the duobinary waveform. We only create it explicitly, above,</span>
        <span class="c1">#       so that we&#39;ll have an ideal reference for comparison.</span>
        <span class="n">chnl_h</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_chnl_h</span><span class="p">()</span>
        <span class="n">chnl_out</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">chnl_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channel_perf</span> <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="n">split_time</span>        <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Running Tx...(sweep </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sweep_num</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Exception: channel&#39;</span>
        <span class="k">raise</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">chnl_out</span>    <span class="o">=</span> <span class="n">chnl_out</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">chnl_out_H</span>  <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">chnl_out</span><span class="p">)</span>

    <span class="c1"># Generate the output from, and the incremental/cumulative impulse/step/frequency responses of, the Tx.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_use_ami</span><span class="p">):</span>
            <span class="c1"># Note: Within the PyBERT computational environment, we use normalized impulse responses,</span>
            <span class="c1">#       which have units of (V/ts), where &#39;ts&#39; is the sample interval. However, IBIS-AMI models expect</span>
            <span class="c1">#       units of (V/s). So, we have to scale accordingly, as we transit the boundary between these two worlds.</span>
            <span class="n">tx_cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_cfg</span>  <span class="c1"># Grab the &#39;AMIParamConfigurator&#39; instance for this model.</span>
            <span class="c1"># Get the model invoked and initialized, except for &#39;channel_response&#39;, which</span>
            <span class="c1"># we need to do several different ways, in order to gather all the data we need.</span>
            <span class="n">tx_param_dict</span> <span class="o">=</span> <span class="n">tx_cfg</span><span class="o">.</span><span class="n">input_ami_params</span>
            <span class="n">tx_model_init</span> <span class="o">=</span> <span class="n">AMIModelInitializer</span><span class="p">(</span><span class="n">tx_param_dict</span><span class="p">)</span>
            <span class="n">tx_model_init</span><span class="o">.</span><span class="n">sample_interval</span> <span class="o">=</span> <span class="n">ts</span>  <span class="c1"># Must be set, before &#39;channel_response&#39;!</span>
            <span class="n">tx_model_init</span><span class="o">.</span><span class="n">channel_response</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">ts</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Start with a delta function, to capture the model&#39;s impulse response.</span>
            <span class="n">tx_model_init</span><span class="o">.</span><span class="n">bit_time</span> <span class="o">=</span> <span class="n">ui</span>
            <span class="n">tx_model</span> <span class="o">=</span> <span class="n">AMIModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_dll_file</span><span class="p">)</span>
            <span class="n">tx_model</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">tx_model_init</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Tx IBIS-AMI model initialization results:</span><span class="se">\n</span><span class="s2">Input parameters: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Output parameters: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Message: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tx_model</span><span class="o">.</span><span class="n">ami_params_in</span><span class="p">,</span> <span class="n">tx_model</span><span class="o">.</span><span class="n">ami_params_out</span><span class="p">,</span> <span class="n">tx_model</span><span class="o">.</span><span class="n">msg</span><span class="p">))</span>
            <span class="k">if</span><span class="p">(</span><span class="n">tx_cfg</span><span class="o">.</span><span class="n">fetch_param_val</span><span class="p">([</span><span class="s1">&#39;Reserved_Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Init_Returns_Impulse&#39;</span><span class="p">])):</span>
                <span class="n">tx_h</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">tx_model</span><span class="o">.</span><span class="n">initOut</span><span class="p">)</span> <span class="o">*</span> <span class="n">ts</span>
            <span class="k">elif</span><span class="p">(</span><span class="ow">not</span> <span class="n">tx_cfg</span><span class="o">.</span><span class="n">fetch_param_val</span><span class="p">([</span><span class="s1">&#39;Reserved_Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;GetWave_Exists&#39;</span><span class="p">])):</span>
                <span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Both &#39;Init_Returns_Impulse&#39; and &#39;GetWave_Exists&#39; are False!</span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                        I cannot continue.</span><span class="se">\n</span><span class="s2">This condition is supposed to be caught sooner in the flow.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Simulation Error.&quot;</span>
                <span class="k">return</span>
            <span class="k">elif</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_use_getwave</span><span class="p">):</span>
                <span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: You have elected not to use GetWave for a model, which does not return an impulse response!</span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                        I cannot continue.</span><span class="se">\n</span><span class="s2">Please, select &#39;Use GetWave&#39; and try again.&quot;</span><span class="p">,</span> <span class="s1">&#39;PyBERT Alert&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Simulation Error.&quot;</span>
                <span class="k">return</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_use_getwave</span><span class="p">):</span>
                <span class="c1"># For GetWave, use a step to extract the model&#39;s native properties.</span>
                <span class="c1"># Position the input edge at the center of the vector, in</span>
                <span class="c1"># order to minimize high frequency artifactual energy</span>
                <span class="c1"># introduced by frequency domain processing in some models.</span>
                <span class="n">half_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">tx_s</span> <span class="o">=</span> <span class="n">tx_model</span><span class="o">.</span><span class="n">getWave</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="n">half_len</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span> <span class="o">*</span> <span class="n">half_len</span><span class="p">))</span>
                <span class="c1"># Shift the result back to the correct location, extending the last sample.</span>
                <span class="n">tx_s</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">tx_s</span><span class="p">[</span><span class="n">half_len</span><span class="p">:],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_len</span><span class="p">),</span> <span class="s1">&#39;edge&#39;</span><span class="p">)</span>
                <span class="n">tx_h</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">concatenate</span><span class="p">((</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span> <span class="n">tx_s</span><span class="p">)))</span>  <span class="c1"># Without the leading 0, we miss the pre-tap.</span>
                <span class="n">tx_out</span> <span class="o">=</span> <span class="n">tx_model</span><span class="o">.</span><span class="n">getWave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Init()-only.</span>
                <span class="n">tx_s</span> <span class="o">=</span> <span class="n">tx_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
                <span class="n">tx_out</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">tx_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># - Generate the ideal, post-preemphasis signal.</span>
            <span class="c1"># To consider: use &#39;scipy.interp()&#39;. This is what Mark does, in order to induce jitter in the Tx output.</span>
            <span class="n">ffe_out</span>           <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">ffe</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rel_power</span>    <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">ffe_out</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>                    <span class="c1"># Store the relative average power dissipated in the Tx.</span>
            <span class="n">tx_out</span>            <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">ffe_out</span><span class="p">,</span> <span class="n">nspui</span><span class="p">)</span>                <span class="c1"># oversampled output</span>

            <span class="c1"># - Calculate the responses.</span>
            <span class="c1"># - (The Tx is unique in that the calculated responses aren&#39;t used to form the output.</span>
            <span class="c1">#    This is partly due to the out of order nature in which we combine the Tx and channel,</span>
            <span class="c1">#    and partly due to the fact that we&#39;re adding noise to the Tx output.)</span>
            <span class="n">tx_h</span>   <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="nb">sum</span><span class="p">([[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="n">nspui</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ffe</span><span class="p">],</span> <span class="p">[]))</span>  <span class="c1"># Using sum to concatenate.</span>
            <span class="n">tx_h</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">))</span>
            <span class="n">tx_s</span>   <span class="o">=</span> <span class="n">tx_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

        <span class="n">temp</span>   <span class="o">=</span> <span class="n">tx_h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="n">tx_H</span>   <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">tx_H</span>  <span class="o">*=</span> <span class="n">tx_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">tx_H</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># - Generate the uncorrelated periodic noise. (Assume capacitive coupling.)</span>
        <span class="c1">#   - Generate the ideal rectangular aggressor waveform.</span>
        <span class="n">pn_period</span>          <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">pn_freq</span>
        <span class="n">pn_samps</span>           <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pn_period</span> <span class="o">/</span> <span class="n">Ts</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">pn</span>                 <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">pn_samps</span><span class="p">)</span>
        <span class="n">pn</span><span class="p">[</span><span class="n">pn_samps</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">pn_mag</span>
        <span class="n">pn</span>                 <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx_out</span><span class="p">))</span>
        <span class="c1">#   - High pass filter it. (Simulating capacitive coupling.)</span>
        <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">=</span> <span class="n">iirfilter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">gFc</span><span class="o">/</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;highpass&#39;</span><span class="p">)</span>
        <span class="n">pn</span>     <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">pn</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">pn</span><span class="p">)]</span>

        <span class="c1"># - Add the uncorrelated periodic and random noise to the Tx output.</span>
        <span class="n">tx_out</span> <span class="o">+=</span> <span class="n">pn</span>
        <span class="n">tx_out</span> <span class="o">+=</span> <span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">rn</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_out</span><span class="p">),))</span>

        <span class="c1"># - Convolve w/ channel.</span>
        <span class="n">tx_out_h</span>   <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">tx_h</span><span class="p">,</span> <span class="n">chnl_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)]</span>
        <span class="n">temp</span>       <span class="o">=</span> <span class="n">tx_out_h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="n">tx_out_H</span>   <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">rx_in</span>      <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">tx_out</span><span class="p">,</span> <span class="n">chnl_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_out</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tx_s</span>      <span class="o">=</span> <span class="n">tx_s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_out</span>    <span class="o">=</span> <span class="n">tx_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_in</span>     <span class="o">=</span> <span class="n">rx_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_s</span>  <span class="o">=</span> <span class="n">tx_out_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_p</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_s</span><span class="p">[</span><span class="n">nspui</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_s</span><span class="p">[:</span><span class="o">-</span><span class="n">nspui</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_H</span>      <span class="o">=</span> <span class="n">tx_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_h</span>      <span class="o">=</span> <span class="n">tx_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_H</span>  <span class="o">=</span> <span class="n">tx_out_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_h</span>  <span class="o">=</span> <span class="n">tx_out_h</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tx_perf</span>   <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">split_time</span><span class="p">)</span>
        <span class="n">split_time</span>     <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>    <span class="o">=</span> <span class="s1">&#39;Running CTLE...(sweep </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sweep_num</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Exception: Tx&#39;</span>
        <span class="k">raise</span>

    <span class="c1"># Generate the output from, and the incremental/cumulative impulse/step/frequency responses of, the CTLE.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_use_ami</span><span class="p">):</span>
            <span class="n">rx_cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx_cfg</span>  <span class="c1"># Grab the &#39;AMIParamConfigurator&#39; instance for this model.</span>
            <span class="c1"># Get the model invoked and initialized, except for &#39;channel_response&#39;, which</span>
            <span class="c1"># we need to do several different ways, in order to gather all the data we need.</span>
            <span class="n">rx_param_dict</span> <span class="o">=</span> <span class="n">rx_cfg</span><span class="o">.</span><span class="n">input_ami_params</span>
            <span class="n">rx_model_init</span> <span class="o">=</span> <span class="n">AMIModelInitializer</span><span class="p">(</span><span class="n">rx_param_dict</span><span class="p">)</span>
            <span class="n">rx_model_init</span><span class="o">.</span><span class="n">sample_interval</span> <span class="o">=</span> <span class="n">ts</span>  <span class="c1"># Must be set, before &#39;channel_response&#39;!</span>
            <span class="n">rx_model_init</span><span class="o">.</span><span class="n">channel_response</span> <span class="o">=</span> <span class="n">tx_out_h</span> <span class="o">/</span> <span class="n">ts</span>
            <span class="n">rx_model_init</span><span class="o">.</span><span class="n">bit_time</span> <span class="o">=</span> <span class="n">ui</span>
            <span class="n">rx_model</span> <span class="o">=</span> <span class="n">AMIModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_dll_file</span><span class="p">)</span>
            <span class="n">rx_model</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">rx_model_init</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Rx IBIS-AMI model initialization results:</span><span class="se">\n</span><span class="s2">Input parameters: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Message: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Output parameters: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">rx_model</span><span class="o">.</span><span class="n">ami_params_in</span><span class="p">,</span> <span class="n">rx_model</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="n">rx_model</span><span class="o">.</span><span class="n">ami_params_out</span><span class="p">))</span>
            <span class="k">if</span><span class="p">(</span><span class="n">rx_cfg</span><span class="o">.</span><span class="n">fetch_param_val</span><span class="p">([</span><span class="s1">&#39;Reserved_Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Init_Returns_Impulse&#39;</span><span class="p">])):</span>
                <span class="n">ctle_out_h</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">rx_model</span><span class="o">.</span><span class="n">initOut</span><span class="p">)</span> <span class="o">*</span> <span class="n">ts</span>
            <span class="k">elif</span><span class="p">(</span><span class="ow">not</span> <span class="n">rx_cfg</span><span class="o">.</span><span class="n">fetch_param_val</span><span class="p">([</span><span class="s1">&#39;Reserved_Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;GetWave_Exists&#39;</span><span class="p">])):</span>
                <span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Both &#39;Init_Returns_Impulse&#39; and &#39;GetWave_Exists&#39; are False!</span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                        I cannot continue.</span><span class="se">\n</span><span class="s2">This condition is supposed to be caught sooner in the flow.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Simulation Error.&quot;</span>
                <span class="k">return</span>
            <span class="k">elif</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_use_getwave</span><span class="p">):</span>
                <span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: You have elected not to use GetWave for a model, which does not return an impulse response!</span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                        I cannot continue.</span><span class="se">\n</span><span class="s2">Please, select &#39;Use GetWave&#39; and try again.&quot;</span><span class="p">,</span> <span class="s1">&#39;PyBERT Alert&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Simulation Error.&quot;</span>
                <span class="k">return</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_use_getwave</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">ctle_out</span><span class="p">,</span> <span class="n">clock_times</span> <span class="o">=</span> <span class="n">rx_model</span><span class="o">.</span><span class="n">getWave</span><span class="p">(</span><span class="n">rx_in</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ctle_out</span><span class="p">,</span> <span class="n">clock_times</span> <span class="o">=</span> <span class="n">rx_model</span><span class="o">.</span><span class="n">getWave</span><span class="p">(</span><span class="n">rx_in</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx_in</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rx_model</span><span class="o">.</span><span class="n">ami_params_out</span><span class="p">)</span>

                <span class="n">ctle_H</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">ctle_out</span> <span class="o">*</span> <span class="n">signal</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctle_out</span><span class="p">)))</span> <span class="o">/</span> <span class="n">fft</span><span class="p">(</span><span class="n">rx_in</span> <span class="o">*</span> <span class="n">signal</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx_in</span><span class="p">)))</span>
                <span class="n">ctle_h</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">ctle_H</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)])</span>
                <span class="n">ctle_out_h</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">,</span> <span class="n">tx_out_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Init() only.</span>
                <span class="n">ctle_out_h_padded</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">ctle_out_h</span><span class="p">,</span> <span class="p">(</span><span class="n">nspb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx_in</span><span class="p">)</span> <span class="o">-</span> <span class="n">nspb</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctle_out_h</span><span class="p">)),</span>
                        <span class="s1">&#39;linear_ramp&#39;</span><span class="p">,</span> <span class="n">end_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">tx_out_h_padded</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">tx_out_h</span><span class="p">,</span> <span class="p">(</span><span class="n">nspb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx_in</span><span class="p">)</span> <span class="o">-</span> <span class="n">nspb</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx_out_h</span><span class="p">)),</span>
                        <span class="s1">&#39;linear_ramp&#39;</span><span class="p">,</span> <span class="n">end_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">ctle_H</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">ctle_out_h_padded</span><span class="p">)</span> <span class="o">/</span> <span class="n">fft</span><span class="p">(</span><span class="n">tx_out_h_padded</span><span class="p">)</span>
                <span class="n">ctle_h</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">ctle_H</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)])</span>
                <span class="n">ctle_out</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">rx_in</span><span class="p">,</span> <span class="n">ctle_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_out</span><span class="p">)]</span>
            <span class="n">ctle_s</span> <span class="o">=</span> <span class="n">ctle_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_ctle_file</span><span class="p">):</span>
                <span class="n">ctle_h</span>           <span class="o">=</span> <span class="n">import_channel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctle_file</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">100.</span><span class="p">):</span>          <span class="c1"># step response?</span>
                    <span class="n">ctle_h</span>       <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">)</span>       <span class="c1"># impulse response is derivative of step response.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ctle_h</span>      <span class="o">*=</span> <span class="n">ts</span>                 <span class="c1"># Normalize to (V/sample)</span>
                <span class="n">ctle_h</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="n">ctle_H</span>           <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">)</span>
                <span class="n">ctle_H</span>          <span class="o">*=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">)</span> <span class="o">/</span> <span class="n">ctle_H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w_dummy</span><span class="p">,</span> <span class="n">ctle_H</span> <span class="o">=</span> <span class="n">make_ctle</span><span class="p">(</span><span class="n">rx_bw</span><span class="p">,</span> <span class="n">peak_freq</span><span class="p">,</span> <span class="n">peak_mag</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ctle_mode</span><span class="p">,</span> <span class="n">ctle_offset</span><span class="p">)</span>
                <span class="n">ctle_h</span>          <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">ctle_H</span><span class="p">))[:</span><span class="nb">len</span><span class="p">(</span><span class="n">chnl_h</span><span class="p">)]</span>
                <span class="n">ctle_h</span>         <span class="o">*=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ctle_H</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ctle_h</span><span class="p">)</span>
            <span class="n">ctle_out</span>        <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">rx_in</span><span class="p">,</span> <span class="n">ctle_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_out</span><span class="p">)]</span>
            <span class="n">ctle_out</span>       <span class="o">-=</span> <span class="n">mean</span><span class="p">(</span><span class="n">ctle_out</span><span class="p">)</span>             <span class="c1"># Force zero mean.</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctle_mode</span> <span class="o">==</span> <span class="s1">&#39;AGC&#39;</span><span class="p">):</span>                 <span class="c1"># Automatic gain control engaged?</span>
                <span class="n">ctle_out</span>   <span class="o">*=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">decision_scaler</span> <span class="o">/</span> <span class="n">ctle_out</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span>
            <span class="n">ctle_s</span> <span class="o">=</span> <span class="n">ctle_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
            <span class="n">ctle_out_h</span>      <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">tx_out_h</span><span class="p">,</span> <span class="n">ctle_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_out_h</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_s</span>     <span class="o">=</span> <span class="n">ctle_s</span>
        <span class="n">ctle_out_h_main_lobe</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">ctle_out_h</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ctle_out_h</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctle_out_h_main_lobe</span><span class="p">)):</span>
            <span class="n">conv_dly_ix</span> <span class="o">=</span> <span class="n">ctle_out_h_main_lobe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conv_dly_ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chnl_dly</span> <span class="o">/</span> <span class="n">Ts</span>
        <span class="n">conv_dly</span>        <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">conv_dly_ix</span><span class="p">]</span>
        <span class="n">ctle_out_s</span>      <span class="o">=</span> <span class="n">ctle_out_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">temp</span>            <span class="o">=</span> <span class="n">ctle_out_h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="n">ctle_out_H</span>      <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="c1"># - Store local variables to class instance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_s</span> <span class="o">=</span> <span class="n">ctle_out_s</span>
        <span class="c1"># Consider changing this; it could be sensitive to insufficient &quot;front porch&quot; in the CTLE output step response.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_s</span><span class="p">[</span><span class="n">nspui</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_s</span><span class="p">[:</span><span class="o">-</span><span class="n">nspui</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_H</span>     <span class="o">=</span> <span class="n">ctle_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_h</span>     <span class="o">=</span> <span class="n">ctle_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_H</span> <span class="o">=</span> <span class="n">ctle_out_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_h</span> <span class="o">=</span> <span class="n">ctle_out_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out</span>   <span class="o">=</span> <span class="n">ctle_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_dly</span>   <span class="o">=</span> <span class="n">conv_dly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_dly_ix</span> <span class="o">=</span> <span class="n">conv_dly_ix</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctle_perf</span>  <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">split_time</span><span class="p">)</span>
        <span class="n">split_time</span>      <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>     <span class="o">=</span> <span class="s1">&#39;Running DFE/CDR...(sweep </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sweep_num</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Exception: Rx&#39;</span>
        <span class="k">raise</span>

    <span class="c1"># Generate the output from, and the incremental/cumulative impulse/step/frequency responses of, the DFE.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_dfe</span><span class="p">):</span>
            <span class="n">dfe</span> <span class="o">=</span> <span class="n">DFE</span><span class="p">(</span><span class="n">n_taps</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ui</span><span class="p">,</span> <span class="n">nspui</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">mod_type</span><span class="p">,</span>
                        <span class="n">n_ave</span><span class="o">=</span><span class="n">n_ave</span><span class="p">,</span> <span class="n">n_lock_ave</span><span class="o">=</span><span class="n">n_lock_ave</span><span class="p">,</span> <span class="n">rel_lock_tol</span><span class="o">=</span><span class="n">rel_lock_tol</span><span class="p">,</span> <span class="n">lock_sustain</span><span class="o">=</span><span class="n">lock_sustain</span><span class="p">,</span>
                        <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span> <span class="n">ideal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sum_ideal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfe</span> <span class="o">=</span> <span class="n">DFE</span><span class="p">(</span><span class="n">n_taps</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ui</span><span class="p">,</span> <span class="n">nspui</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">mod_type</span><span class="p">,</span>
                        <span class="n">n_ave</span><span class="o">=</span><span class="n">n_ave</span><span class="p">,</span> <span class="n">n_lock_ave</span><span class="o">=</span><span class="n">n_lock_ave</span><span class="p">,</span> <span class="n">rel_lock_tol</span><span class="o">=</span><span class="n">rel_lock_tol</span><span class="p">,</span> <span class="n">lock_sustain</span><span class="o">=</span><span class="n">lock_sustain</span><span class="p">,</span>
                        <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span> <span class="n">ideal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">dfe_out</span><span class="p">,</span> <span class="n">tap_weights</span><span class="p">,</span> <span class="n">ui_ests</span><span class="p">,</span> <span class="n">clocks</span><span class="p">,</span> <span class="n">lockeds</span><span class="p">,</span> <span class="n">clock_times</span><span class="p">,</span> <span class="n">bits_out</span><span class="p">)</span> <span class="o">=</span> <span class="n">dfe</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ctle_out</span><span class="p">)</span>
        <span class="n">bits_out</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">bits_out</span><span class="p">)</span>
        <span class="n">auto_corr</span>       <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">correlate</span><span class="p">(</span><span class="n">bits_out</span><span class="p">[(</span><span class="n">nbits</span> <span class="o">-</span> <span class="n">eye_bits</span><span class="p">):],</span> <span class="n">bits</span><span class="p">[(</span><span class="n">nbits</span> <span class="o">-</span> <span class="n">eye_bits</span><span class="p">):],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span> \
                            <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">bits</span><span class="p">[(</span><span class="n">nbits</span> <span class="o">-</span> <span class="n">eye_bits</span><span class="p">):])</span>
        <span class="n">auto_corr</span>       <span class="o">=</span> <span class="n">auto_corr</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">auto_corr</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_corr</span>  <span class="o">=</span> <span class="n">auto_corr</span>
        <span class="n">bit_dly</span>         <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">auto_corr</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">auto_corr</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bits_ref</span>        <span class="o">=</span> <span class="n">bits</span><span class="p">[(</span><span class="n">nbits</span> <span class="o">-</span> <span class="n">eye_bits</span><span class="p">)</span> <span class="p">:]</span>
        <span class="n">bits_tst</span>        <span class="o">=</span> <span class="n">bits_out</span><span class="p">[(</span><span class="n">nbits</span> <span class="o">+</span> <span class="n">bit_dly</span> <span class="o">-</span> <span class="n">eye_bits</span><span class="p">)</span> <span class="p">:]</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bits_ref</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits_tst</span><span class="p">)):</span>
            <span class="n">bits_ref</span> <span class="o">=</span> <span class="n">bits_ref</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits_tst</span><span class="p">)]</span>
        <span class="k">elif</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bits_tst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits_ref</span><span class="p">)):</span>
            <span class="n">bits_tst</span> <span class="o">=</span> <span class="n">bits_tst</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits_ref</span><span class="p">)]</span>
        <span class="n">bit_errs</span>        <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">bits_tst</span> <span class="o">^</span> <span class="n">bits_ref</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bit_errs</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bit_errs</span><span class="p">)</span>

        <span class="n">dfe_h</span>          <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="n">nspb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([[</span><span class="o">-</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="n">nspb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tap_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[]))</span>
        <span class="n">dfe_h</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctle_out_h</span><span class="p">))</span>
        <span class="n">temp</span>           <span class="o">=</span> <span class="n">dfe_h</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="n">dfe_H</span>          <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_s</span>     <span class="o">=</span> <span class="n">dfe_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">dfe_out_H</span>      <span class="o">=</span> <span class="n">ctle_out_H</span> <span class="o">*</span> <span class="n">dfe_H</span>
        <span class="n">dfe_out_h</span>      <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">ctle_out_h</span><span class="p">,</span> <span class="n">dfe_h</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">ctle_out_h</span><span class="p">)]</span>
        <span class="n">dfe_out_s</span>      <span class="o">=</span> <span class="n">dfe_out_h</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_p</span> <span class="o">=</span> <span class="n">dfe_out_s</span> <span class="o">-</span> <span class="n">pad</span><span class="p">(</span><span class="n">dfe_out_s</span><span class="p">[:</span><span class="o">-</span><span class="n">nspui</span><span class="p">],</span> <span class="p">(</span><span class="n">nspui</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_H</span>     <span class="o">=</span> <span class="n">dfe_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_h</span>     <span class="o">=</span> <span class="n">dfe_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_H</span> <span class="o">=</span> <span class="n">dfe_out_H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_h</span> <span class="o">=</span> <span class="n">dfe_out_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_s</span> <span class="o">=</span> <span class="n">dfe_out_s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out</span>   <span class="o">=</span> <span class="n">dfe_out</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dfe_perf</span>  <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">split_time</span><span class="p">)</span>
        <span class="n">split_time</span>     <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>    <span class="o">=</span> <span class="s1">&#39;Analyzing jitter...(sweep </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sweep_num</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Exception: DFE&#39;</span>
        <span class="k">raise</span>

    <span class="c1"># Save local variables to class instance for state preservation, performing unit conversion where necessary.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adaptation</span>  <span class="o">=</span> <span class="n">tap_weights</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui_ests</span>     <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">ui_ests</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.e12</span> <span class="c1"># (ps)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clocks</span>      <span class="o">=</span> <span class="n">clocks</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lockeds</span>     <span class="o">=</span> <span class="n">lockeds</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clock_times</span> <span class="o">=</span> <span class="n">clock_times</span>

    <span class="c1"># Analyze the jitter.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thresh_tx</span>              <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_tx</span>          <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_tx</span>              <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_tx</span>     <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_tx</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thresh_ctle</span>              <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_ctle</span>          <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ctle</span>              <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_ctle</span>     <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_ctle</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thresh_dfe</span>              <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_dfe</span>          <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_dfe</span>              <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_dfe</span>     <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_dfe</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f_MHz_dfe</span>               <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">jitter_rejection_ratio</span>  <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mod_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Handle duo-binary case.</span>
            <span class="n">pattern_len</span> <span class="o">*=</span> <span class="mi">2</span>        <span class="c1"># Because, the XOR pre-coding can invert every other pattern rep.</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mod_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Handle PAM-4 case.</span>
            <span class="k">if</span><span class="p">(</span><span class="n">pattern_len</span> <span class="o">%</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">pattern_len</span> <span class="o">*=</span> <span class="mi">2</span>    <span class="c1"># Because, the bits are taken in pairs, to form the symbols.</span>

        <span class="c1"># - channel output</span>
        <span class="n">actual_xings</span> <span class="o">=</span> <span class="n">find_crossings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">chnl_out</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">mod_type</span><span class="o">=</span><span class="n">mod_type</span><span class="p">)</span>
        <span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="n">t_jitter</span><span class="p">,</span> <span class="n">isi</span><span class="p">,</span> <span class="n">dcd</span><span class="p">,</span> <span class="n">pj</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">jitter_ext</span><span class="p">,</span> \
            <span class="n">thresh</span><span class="p">,</span> <span class="n">jitter_spectrum</span><span class="p">,</span> <span class="n">jitter_ind_spectrum</span><span class="p">,</span> <span class="n">spectrum_freqs</span><span class="p">,</span> \
            <span class="n">hist</span><span class="p">,</span> <span class="n">hist_synth</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">)</span> <span class="o">=</span> <span class="n">calc_jitter</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">pattern_len</span><span class="p">,</span> <span class="n">ideal_xings</span><span class="p">,</span> <span class="n">actual_xings</span><span class="p">,</span> <span class="n">rel_thresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_jitter</span>                 <span class="o">=</span> <span class="n">t_jitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isi_chnl</span>                 <span class="o">=</span> <span class="n">isi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_chnl</span>                 <span class="o">=</span> <span class="n">dcd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pj_chnl</span>                  <span class="o">=</span> <span class="n">pj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rj_chnl</span>                  <span class="o">=</span> <span class="n">rj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_chnl</span>              <span class="o">=</span> <span class="n">thresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_chnl</span>              <span class="o">=</span> <span class="n">hist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_chnl</span>          <span class="o">=</span> <span class="n">hist_synth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_bins</span>              <span class="o">=</span> <span class="n">bin_centers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_chnl</span>     <span class="o">=</span> <span class="n">jitter_spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_chnl</span> <span class="o">=</span> <span class="n">jitter_ind_spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_MHz</span>                    <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">spectrum_freqs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.e-6</span>

        <span class="c1"># - Tx output</span>
        <span class="n">actual_xings</span> <span class="o">=</span> <span class="n">find_crossings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">rx_in</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">mod_type</span><span class="o">=</span><span class="n">mod_type</span><span class="p">)</span>
        <span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="n">t_jitter</span><span class="p">,</span> <span class="n">isi</span><span class="p">,</span> <span class="n">dcd</span><span class="p">,</span> <span class="n">pj</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">jitter_ext</span><span class="p">,</span> \
            <span class="n">thresh</span><span class="p">,</span> <span class="n">jitter_spectrum</span><span class="p">,</span> <span class="n">jitter_ind_spectrum</span><span class="p">,</span> <span class="n">spectrum_freqs</span><span class="p">,</span> \
            <span class="n">hist</span><span class="p">,</span> <span class="n">hist_synth</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">)</span> <span class="o">=</span> <span class="n">calc_jitter</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">pattern_len</span><span class="p">,</span> <span class="n">ideal_xings</span><span class="p">,</span> <span class="n">actual_xings</span><span class="p">,</span> <span class="n">rel_thresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isi_tx</span>                 <span class="o">=</span> <span class="n">isi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_tx</span>                 <span class="o">=</span> <span class="n">dcd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pj_tx</span>                  <span class="o">=</span> <span class="n">pj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rj_tx</span>                  <span class="o">=</span> <span class="n">rj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_tx</span>              <span class="o">=</span> <span class="n">thresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_tx</span>              <span class="o">=</span> <span class="n">hist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_tx</span>          <span class="o">=</span> <span class="n">hist_synth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_tx</span>     <span class="o">=</span> <span class="n">jitter_spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_tx</span> <span class="o">=</span> <span class="n">jitter_ind_spectrum</span>

        <span class="c1"># - CTLE output</span>
        <span class="n">actual_xings</span> <span class="o">=</span> <span class="n">find_crossings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ctle_out</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">mod_type</span><span class="o">=</span><span class="n">mod_type</span><span class="p">)</span>
        <span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="n">t_jitter</span><span class="p">,</span> <span class="n">isi</span><span class="p">,</span> <span class="n">dcd</span><span class="p">,</span> <span class="n">pj</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">jitter_ext</span><span class="p">,</span> \
            <span class="n">thresh</span><span class="p">,</span> <span class="n">jitter_spectrum</span><span class="p">,</span> <span class="n">jitter_ind_spectrum</span><span class="p">,</span> <span class="n">spectrum_freqs</span><span class="p">,</span> \
            <span class="n">hist</span><span class="p">,</span> <span class="n">hist_synth</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">)</span> <span class="o">=</span> <span class="n">calc_jitter</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">pattern_len</span><span class="p">,</span> <span class="n">ideal_xings</span><span class="p">,</span> <span class="n">actual_xings</span><span class="p">,</span> <span class="n">rel_thresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isi_ctle</span>                 <span class="o">=</span> <span class="n">isi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_ctle</span>                 <span class="o">=</span> <span class="n">dcd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pj_ctle</span>                  <span class="o">=</span> <span class="n">pj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rj_ctle</span>                  <span class="o">=</span> <span class="n">rj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_ctle</span>              <span class="o">=</span> <span class="n">thresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ctle</span>              <span class="o">=</span> <span class="n">hist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_ctle</span>          <span class="o">=</span> <span class="n">hist_synth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_ctle</span>     <span class="o">=</span> <span class="n">jitter_spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_ctle</span> <span class="o">=</span> <span class="n">jitter_ind_spectrum</span>

        <span class="c1"># - DFE output</span>
        <span class="n">ignore_until</span>  <span class="o">=</span> <span class="p">(</span><span class="n">nui</span> <span class="o">-</span> <span class="n">eye_uis</span><span class="p">)</span> <span class="o">*</span> <span class="n">ui</span> <span class="o">+</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">ui</span>  <span class="c1"># 0.5 was causing an occasional misalignment.</span>
        <span class="n">ideal_xings</span>   <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">ignore_until</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">ideal_xings</span><span class="p">)))</span>
        <span class="n">min_delay</span>     <span class="o">=</span> <span class="n">ignore_until</span> <span class="o">+</span> <span class="n">conv_dly</span>
        <span class="n">actual_xings</span>  <span class="o">=</span> <span class="n">find_crossings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dfe_out</span><span class="p">,</span> <span class="n">decision_scaler</span><span class="p">,</span> <span class="n">min_delay</span><span class="o">=</span><span class="n">min_delay</span><span class="p">,</span>
                                                                    <span class="n">mod_type</span><span class="o">=</span><span class="n">mod_type</span><span class="p">,</span>
                                                                    <span class="n">rising_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                        <span class="p">)</span>
        <span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="n">t_jitter</span><span class="p">,</span> <span class="n">isi</span><span class="p">,</span> <span class="n">dcd</span><span class="p">,</span> <span class="n">pj</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">jitter_ext</span><span class="p">,</span> \
            <span class="n">thresh</span><span class="p">,</span> <span class="n">jitter_spectrum</span><span class="p">,</span> <span class="n">jitter_ind_spectrum</span><span class="p">,</span> <span class="n">spectrum_freqs</span><span class="p">,</span> \
            <span class="n">hist</span><span class="p">,</span> <span class="n">hist_synth</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">)</span> <span class="o">=</span> <span class="n">calc_jitter</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">eye_uis</span><span class="p">,</span> <span class="n">pattern_len</span><span class="p">,</span> <span class="n">ideal_xings</span><span class="p">,</span> <span class="n">actual_xings</span><span class="p">,</span> <span class="n">rel_thresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isi_dfe</span>                 <span class="o">=</span> <span class="n">isi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_dfe</span>                 <span class="o">=</span> <span class="n">dcd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pj_dfe</span>                  <span class="o">=</span> <span class="n">pj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rj_dfe</span>                  <span class="o">=</span> <span class="n">rj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_dfe</span>              <span class="o">=</span> <span class="n">thresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_dfe</span>              <span class="o">=</span> <span class="n">hist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_dfe</span>          <span class="o">=</span> <span class="n">hist_synth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_dfe</span>     <span class="o">=</span> <span class="n">jitter_spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_dfe</span> <span class="o">=</span> <span class="n">jitter_ind_spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_MHz_dfe</span>               <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">spectrum_freqs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.e-6</span>
        <span class="n">skip_factor</span>                  <span class="o">=</span> <span class="n">nbits</span> <span class="o">/</span> <span class="n">eye_bits</span>
        <span class="n">ctle_spec</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_ctle</span>
        <span class="n">dfe_spec</span>                     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_dfe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_rejection_ratio</span>  <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfe_spec</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jitter_perf</span> <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">split_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_perf</span>  <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="n">split_time</span>       <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>      <span class="o">=</span> <span class="s1">&#39;Updating plots...(sweep </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sweep_num</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Exception: jitter&#39;</span>
        <span class="c1"># raise</span>

    <span class="c1"># Update plots.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">update_plots</span><span class="p">):</span>
            <span class="n">update_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">initial_run</span><span class="p">):</span>
                <span class="n">update_eyes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_perf</span> <span class="o">=</span> <span class="n">nbits</span> <span class="o">*</span> <span class="n">nspb</span> <span class="o">/</span> <span class="p">(</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">split_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Ready.&#39;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span>       <span class="o">=</span> <span class="s1">&#39;Exception: plotting&#39;</span>
        <span class="k">raise</span></div>

<span class="c1"># Plot updating</span>
<div class="viewcode-block" id="update_results"><a class="viewcode-back" href="../../modules.html#pybert.pybert_cntrl.update_results">[docs]</a><span class="k">def</span> <span class="nf">update_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates all plot data used by GUI.</span>

<span class="sd">    Args:</span>
<span class="sd">        self(PyBERT): Reference to an instance of the *PyBERT* class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Copy globals into local namespace.</span>
    <span class="n">ui</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span>
    <span class="n">samps_per_ui</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>
    <span class="n">eye_uis</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_uis</span>
    <span class="n">num_ui</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span>
    <span class="n">clock_times</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock_times</span>
    <span class="n">f</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
    <span class="n">t</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
    <span class="n">t_ns</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_ns</span>
    <span class="n">t_ns_chnl</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_ns_chnl</span>
    <span class="n">conv_dly_ix</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_dly_ix</span>
    <span class="n">n_taps</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_taps</span>

    <span class="n">Ts</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ignore_until</span>  <span class="o">=</span> <span class="p">(</span><span class="n">num_ui</span> <span class="o">-</span> <span class="n">eye_uis</span><span class="p">)</span> <span class="o">*</span> <span class="n">ui</span>
    <span class="n">ignore_samps</span>  <span class="o">=</span> <span class="p">(</span><span class="n">num_ui</span> <span class="o">-</span> <span class="n">eye_uis</span><span class="p">)</span> <span class="o">*</span> <span class="n">samps_per_ui</span>

    <span class="c1"># Misc.</span>
    <span class="n">f_GHz</span>         <span class="o">=</span> <span class="n">f</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1.e9</span>
    <span class="n">len_f_GHz</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f_GHz</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;f_GHz&quot;</span><span class="p">,</span>     <span class="n">f_GHz</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;t_ns&quot;</span><span class="p">,</span>      <span class="n">t_ns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;t_ns_chnl&quot;</span><span class="p">,</span> <span class="n">t_ns_chnl</span><span class="p">)</span>

    <span class="c1"># DFE.</span>
    <span class="n">tap_weights</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adaptation</span><span class="p">))</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">tap_weight</span> <span class="ow">in</span> <span class="n">tap_weights</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tap</span><span class="si">%d</span><span class="s2">_weights&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">tap_weight</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tap_weight_index&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tap_weight</span><span class="p">)))</span>
    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_n_taps</span> <span class="o">!=</span> <span class="n">n_taps</span><span class="p">):</span>
        <span class="n">new_plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="p">,</span> <span class="n">auto_colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">],</span> <span class="n">padding_left</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_taps</span><span class="p">):</span>
            <span class="n">new_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="s2">&quot;tap_weight_index&quot;</span><span class="p">,</span> <span class="s2">&quot;tap</span><span class="si">%d</span><span class="s2">_weights&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;tap</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">new_plot</span><span class="o">.</span><span class="n">title</span>  <span class="o">=</span> <span class="s2">&quot;DFE Adaptation&quot;</span>
        <span class="n">new_plot</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PanTool</span><span class="p">(</span><span class="n">new_plot</span><span class="p">,</span> <span class="n">constrain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constrain_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constrain_direction</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">))</span>
        <span class="n">zoom9</span> <span class="o">=</span> <span class="n">ZoomTool</span><span class="p">(</span><span class="n">new_plot</span><span class="p">,</span> <span class="n">tool_mode</span><span class="o">=</span><span class="s2">&quot;range&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">always_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">new_plot</span><span class="o">.</span><span class="n">overlays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zoom9</span><span class="p">)</span>
        <span class="n">new_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">new_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="s1">&#39;ul&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots_dfe</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dfe_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots_dfe</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dfe_plot</span> <span class="o">=</span> <span class="n">new_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_n_taps</span> <span class="o">=</span> <span class="n">n_taps</span>

    <span class="n">clock_pers</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">clock_times</span><span class="p">)</span>
    <span class="n">start_t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockeds</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">start_ix</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">clock_times</span> <span class="o">&gt;</span> <span class="n">start_t</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">(</span><span class="n">bin_counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">)</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">clock_pers</span><span class="p">[</span><span class="n">start_ix</span><span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">bin_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">clock_spec</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">clock_pers</span><span class="p">[</span><span class="n">start_ix</span><span class="p">:])</span>
    <span class="n">clock_spec</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">clock_spec</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">clock_spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">spec_freqs</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clock_spec</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">clock_spec</span><span class="p">))</span>  <span class="c1"># In this case, fNyquist = half the bit rate.</span>
    <span class="n">clock_spec</span> <span class="o">/=</span> <span class="n">clock_spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Normalize the mean non-d.c. value to 0 dB.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;clk_per_hist_bins&quot;</span><span class="p">,</span>  <span class="n">bin_centers</span> <span class="o">*</span> <span class="mf">1.e12</span><span class="p">)</span>  <span class="c1"># (ps)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;clk_per_hist_vals&quot;</span><span class="p">,</span>  <span class="n">bin_counts</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;clk_spec&quot;</span><span class="p">,</span>  <span class="mf">10.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">clock_spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>  <span class="c1"># Omit the d.c. value.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;clk_freqs&quot;</span><span class="p">,</span>  <span class="n">spec_freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_out&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ui_ests&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">ui_ests</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;clocks&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">clocks</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;lockeds&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">lockeds</span><span class="p">)</span>

    <span class="c1"># Impulse responses</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;chnl_h&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">chnl_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>  <span class="c1"># Re-normalize to (V/ns), for plotting.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_h&quot;</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">tx_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_out_h&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_h&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">ctle_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_out_h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_h&quot;</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">dfe_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_out_h&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_h</span> <span class="o">*</span> <span class="mf">1.e-9</span> <span class="o">/</span> <span class="n">Ts</span><span class="p">)</span>

    <span class="c1"># Step responses</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;chnl_s&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">chnl_s</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_s&quot;</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">tx_s</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_out_s&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_s</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_s&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">ctle_s</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_out_s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_s</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_s&quot;</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">dfe_s</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_out_s&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_s</span><span class="p">)</span>

    <span class="c1"># Pulse responses</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;chnl_p&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">chnl_p</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_out_p&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">tx_out_p</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_out_p&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_p</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_out_p&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_p</span><span class="p">)</span>

    <span class="c1"># Outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ideal_signal&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">ideal_signal</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;chnl_out&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">chnl_out</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_out&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">rx_in</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_out&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_out&quot;</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;auto_corr&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">auto_corr</span><span class="p">)</span>

    <span class="c1"># Frequency responses</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;chnl_H&quot;</span><span class="p">,</span>     <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chnl_H</span>    <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;chnl_trimmed_H&quot;</span><span class="p">,</span> <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chnl_trimmed_H</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_H&quot;</span><span class="p">,</span>       <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_H</span>      <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;tx_out_H&quot;</span><span class="p">,</span>   <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_out_H</span>  <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_H&quot;</span><span class="p">,</span>     <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctle_H</span>    <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;ctle_out_H&quot;</span><span class="p">,</span> <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctle_out_H</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_H&quot;</span><span class="p">,</span>      <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfe_H</span>     <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;dfe_out_H&quot;</span><span class="p">,</span>  <span class="mf">20.</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfe_out_H</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">len_f_GHz</span><span class="p">])))</span>

    <span class="c1"># Jitter distributions</span>
    <span class="n">jitter_ext_chnl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_chnl</span> <span class="c1"># These are used, again, in bathtub curve generation, below.</span>
    <span class="n">jitter_ext_tx</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_tx</span>
    <span class="n">jitter_ext_ctle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_ctle</span>
    <span class="n">jitter_ext_dfe</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ext_dfe</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_bins&quot;</span><span class="p">,</span>     <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_bins</span><span class="p">)</span>     <span class="o">*</span> <span class="mf">1.e12</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_chnl&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">jitter_chnl</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ext_chnl&quot;</span><span class="p">,</span> <span class="n">jitter_ext_chnl</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_tx&quot;</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">jitter_tx</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ext_tx&quot;</span><span class="p">,</span>   <span class="n">jitter_ext_tx</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ctle&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">jitter_ctle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ext_ctle&quot;</span><span class="p">,</span> <span class="n">jitter_ext_ctle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_dfe&quot;</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">jitter_dfe</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ext_dfe&quot;</span><span class="p">,</span>  <span class="n">jitter_ext_dfe</span><span class="p">)</span>

    <span class="c1"># Jitter spectrums</span>
    <span class="n">log10_ui</span> <span class="o">=</span> <span class="n">log10</span><span class="p">(</span><span class="n">ui</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;f_MHz&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">f_MHz</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;f_MHz_dfe&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_MHz_dfe</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_spectrum_chnl&quot;</span><span class="p">,</span>     <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_chnl</span>     <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ind_spectrum_chnl&quot;</span><span class="p">,</span> <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_chnl</span> <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;thresh_chnl&quot;</span><span class="p">,</span>              <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_chnl</span>              <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_spectrum_tx&quot;</span><span class="p">,</span>       <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_tx</span>       <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ind_spectrum_tx&quot;</span><span class="p">,</span>   <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_tx</span>   <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;thresh_tx&quot;</span><span class="p">,</span>                <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_tx</span>                <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_spectrum_ctle&quot;</span><span class="p">,</span>     <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_ctle</span>     <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ind_spectrum_ctle&quot;</span><span class="p">,</span> <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_ctle</span> <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;thresh_ctle&quot;</span><span class="p">,</span>              <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_ctle</span>              <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_spectrum_dfe&quot;</span><span class="p">,</span>      <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_spectrum_dfe</span>      <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_ind_spectrum_dfe&quot;</span><span class="p">,</span>  <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter_ind_spectrum_dfe</span>  <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;thresh_dfe&quot;</span><span class="p">,</span>               <span class="mf">10.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_dfe</span>               <span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">log10_ui</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;jitter_rejection_ratio&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter_rejection_ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="c1"># Bathtubs</span>
    <span class="n">half_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jitter_ext_chnl</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1">#  - Channel</span>
    <span class="n">bathtub_chnl</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_chnl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">bathtub_chnl</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">bathtub_chnl</span>    <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">bathtub_chnl</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_chnl</span><span class="p">[:</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])))</span>
    <span class="n">bathtub_chnl</span>    <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">bathtub_chnl</span> <span class="o">&lt;</span> <span class="n">MIN_BATHTUB_VAL</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">MIN_BATHTUB_VAL</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bathtub_chnl</span><span class="p">)),</span>
                            <span class="n">bathtub_chnl</span><span class="p">)</span> <span class="c1"># To avoid Chaco log scale plot wierdness.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;bathtub_chnl&quot;</span><span class="p">,</span> <span class="n">log10</span><span class="p">(</span><span class="n">bathtub_chnl</span><span class="p">))</span>
    <span class="c1">#  - Tx</span>
    <span class="n">bathtub_tx</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_tx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">bathtub_tx</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">bathtub_tx</span>    <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">bathtub_tx</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_tx</span><span class="p">[:</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])))</span>
    <span class="n">bathtub_tx</span>    <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">bathtub_tx</span> <span class="o">&lt;</span> <span class="n">MIN_BATHTUB_VAL</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">MIN_BATHTUB_VAL</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bathtub_tx</span><span class="p">)),</span>
                          <span class="n">bathtub_tx</span><span class="p">)</span> <span class="c1"># To avoid Chaco log scale plot wierdness.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;bathtub_tx&quot;</span><span class="p">,</span> <span class="n">log10</span><span class="p">(</span><span class="n">bathtub_tx</span><span class="p">))</span>
    <span class="c1">#  - CTLE</span>
    <span class="n">bathtub_ctle</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_ctle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">bathtub_ctle</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">bathtub_ctle</span>    <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">bathtub_ctle</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_ctle</span><span class="p">[:</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])))</span>
    <span class="n">bathtub_ctle</span>    <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">bathtub_ctle</span> <span class="o">&lt;</span> <span class="n">MIN_BATHTUB_VAL</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">MIN_BATHTUB_VAL</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bathtub_ctle</span><span class="p">)),</span>
                            <span class="n">bathtub_ctle</span><span class="p">)</span> <span class="c1"># To avoid Chaco log scale plot wierdness.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;bathtub_ctle&quot;</span><span class="p">,</span> <span class="n">log10</span><span class="p">(</span><span class="n">bathtub_ctle</span><span class="p">))</span>
    <span class="c1">#  - DFE</span>
    <span class="n">bathtub_dfe</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_dfe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">bathtub_dfe</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">bathtub_dfe</span>    <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">bathtub_dfe</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">jitter_ext_dfe</span><span class="p">[:</span><span class="n">half_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])))</span>
    <span class="n">bathtub_dfe</span>    <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">bathtub_dfe</span> <span class="o">&lt;</span> <span class="n">MIN_BATHTUB_VAL</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">MIN_BATHTUB_VAL</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bathtub_dfe</span><span class="p">)),</span>
                           <span class="n">bathtub_dfe</span><span class="p">)</span> <span class="c1"># To avoid Chaco log scale plot wierdness.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;bathtub_dfe&quot;</span><span class="p">,</span> <span class="n">log10</span><span class="p">(</span><span class="n">bathtub_dfe</span><span class="p">))</span>

    <span class="c1"># Eyes</span>
    <span class="n">width</span>    <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">samps_per_ui</span>
    <span class="n">xs</span>       <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ui</span> <span class="o">*</span> <span class="mf">1.e12</span><span class="p">,</span> <span class="n">ui</span> <span class="o">*</span> <span class="mf">1.e12</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="n">height</span>   <span class="o">=</span> <span class="mi">100</span>
    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chnl_out</span><span class="p">)))</span>
    <span class="n">eye_chnl</span> <span class="o">=</span> <span class="n">calc_eye</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">samps_per_ui</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chnl_out</span><span class="p">[</span><span class="n">ignore_samps</span><span class="p">:],</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_in</span><span class="p">)))</span>
    <span class="n">eye_tx</span>   <span class="o">=</span> <span class="n">calc_eye</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">samps_per_ui</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_in</span><span class="p">[</span><span class="n">ignore_samps</span><span class="p">:],</span>   <span class="n">y_max</span><span class="p">)</span>
    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctle_out</span><span class="p">)))</span>
    <span class="n">eye_ctle</span> <span class="o">=</span> <span class="n">calc_eye</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">samps_per_ui</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctle_out</span><span class="p">[</span><span class="n">ignore_samps</span><span class="p">:],</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span><span class="p">(</span><span class="n">clock_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ignore_until</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">clock_times</span><span class="p">),</span> <span class="s2">&quot;ERROR: Insufficient coverage in &#39;clock_times&#39; vector.&quot;</span>
    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfe_out</span><span class="p">)))</span>
    <span class="n">eye_dfe</span>  <span class="o">=</span> <span class="n">calc_eye</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">samps_per_ui</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfe_out</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">clock_times</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;eye_index&quot;</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;eye_chnl&quot;</span><span class="p">,</span>  <span class="n">eye_chnl</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;eye_tx&quot;</span><span class="p">,</span>    <span class="n">eye_tx</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;eye_ctle&quot;</span><span class="p">,</span>  <span class="n">eye_ctle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;eye_dfe&quot;</span><span class="p">,</span>   <span class="n">eye_dfe</span><span class="p">)</span></div>

<div class="viewcode-block" id="update_eyes"><a class="viewcode-back" href="../../modules.html#pybert.pybert_cntrl.update_eyes">[docs]</a><span class="k">def</span> <span class="nf">update_eyes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the heat plots representing the eye diagrams.</span>

<span class="sd">    Args:</span>
<span class="sd">        self(PyBERT): Reference to an instance of the *PyBERT* class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ui</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span>
    <span class="n">samps_per_ui</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspui</span>

    <span class="n">width</span>    <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">samps_per_ui</span>
    <span class="n">height</span>   <span class="o">=</span> <span class="mi">100</span>
    <span class="n">xs</span>       <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ui</span> <span class="o">*</span> <span class="mf">1.e12</span><span class="p">,</span> <span class="n">ui</span> <span class="o">*</span> <span class="mf">1.e12</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chnl_out</span><span class="p">)))</span>
    <span class="n">ys</span>       <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">y_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invalidate_draw</span><span class="p">()</span>

    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_in</span><span class="p">)))</span>
    <span class="n">ys</span>       <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">y_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">invalidate_draw</span><span class="p">()</span>

    <span class="n">y_max</span>    <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfe_out</span><span class="p">)))</span>
    <span class="n">ys</span>       <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">y_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">invalidate_draw</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">invalidate_draw</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">plots_eye</span><span class="o">.</span><span class="n">request_redraw</span><span class="p">()</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, David Banas.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>